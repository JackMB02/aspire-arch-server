<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Aspire Design Lab - Admin Dashboard</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Helvetica+Neue:wght@200;300;400&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="admin.css">
    <style>
      /* Additional styles for file upload and preview */
      .file-upload-container {
        border: 2px dashed var(--border-light);
        border-radius: 8px;
        padding: 2rem;
        text-align: center;
        background: var(--bg-light);
        transition: all 0.3s ease;
        cursor: pointer;
      }
      
      .file-upload-container:hover {
        border-color: var(--accent-light);
        background: rgba(74, 144, 226, 0.05);
      }
      
      .file-upload-container.dragover {
        border-color: var(--accent-light);
        background: rgba(74, 144, 226, 0.1);
      }
      
      .file-input {
        display: none;
      }
      
      .upload-icon {
        font-size: 3rem;
        color: var(--accent-light);
        margin-bottom: 1rem;
      }
      
      .image-preview {
        margin-top: 1rem;
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
      }
      
      .preview-item {
        position: relative;
        width: 120px;
        height: 120px;
        border-radius: 8px;
        overflow: hidden;
        border: 2px solid var(--border-light);
      }
      
      .preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      
      .preview-item .remove-btn {
        position: absolute;
        top: 5px;
        right: 5px;
        background: rgba(255, 0, 0, 0.8);
        color: white;
        border: none;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
      }
      
      .upload-progress {
        margin-top: 1rem;
      }
      
      .progress-bar {
        width: 100%;
        height: 6px;
        background: var(--border-light);
        border-radius: 3px;
        overflow: hidden;
      }
      
      .progress-fill {
        height: 100%;
        background: var(--accent-light);
        transition: width 0.3s ease;
      }
      
      .upload-status {
        margin-top: 0.5rem;
        font-size: 0.9rem;
        color: var(--text-muted);
      }
      
      .gallery-upload {
        margin-top: 1rem;
      }
      
      .gallery-preview {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 0.5rem;
        margin-top: 1rem;
      }
      
      .uploading {
        opacity: 0.7;
        pointer-events: none;
      }
      
      .sector-badge {
        background: #e3f2fd;
        color: #1976d2;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 500;
        display: inline-block;
        margin-left: 8px;
      }

      /* News & Events specific styles */
      .news-badge {
        background: var(--accent-light);
        color: white;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 500;
        display: inline-block;
        margin-left: 8px;
      }
      
      .event-badge {
        background: var(--secondary-dark);
        color: white;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 500;
        display: inline-block;
        margin-left: 8px;
      }
      
      .date-display {
        color: var(--text-muted);
        font-size: 0.9rem;
        margin-top: 0.5rem;
      }
      
      .location-display {
        color: var(--accent-light);
        font-size: 0.9rem;
        margin-top: 0.25rem;
      }
    </style>
  </head>
  <body>
    <!-- Login Screen -->
    <div id="loginScreen">
      <div class="card" id="loginCard">
        <div style="text-align: center; margin-bottom: 2rem;">
          <h1 style="font-weight: 200; color: var(--accent-light); margin-bottom: 0.5rem;">Aspire Design Lab</h1>
          <p style="color: var(--text-muted);">Admin Dashboard</p>
        </div>
        <h3 style="text-align: center; margin-bottom: 1.5rem; font-weight: 300;">Login to Dashboard</h3>
        <div class="input-group">
          <label for="username">Username</label>
          <input id="username" placeholder="Enter username" value="admin" />
        </div>
        <div class="input-group">
          <label for="password">Password</label>
          <input id="password" placeholder="Enter password" type="password" value="changeme" />
        </div>
        <div class="button-group" style="justify-content: center;">
          <button id="loginBtn" class="btn-primary">
            <i class="fas fa-sign-in-alt"></i> Login
          </button>
        </div>
        <div id="loginMsg" style="text-align: center; margin-top: 1rem;"></div>
      </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="hidden">
      <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
          <div class="sidebar-header">
            <h1>Aspire Design Lab</h1>
            <div class="subtitle">Admin Dashboard</div>
          </div>
          <div class="nav-menu">
            <div class="nav-item active" data-section="dashboard">
              <i class="fas fa-chart-line"></i>
              <span>Dashboard</span>
            </div>
            <div class="nav-item" data-section="content">
              <i class="fas fa-plus-circle"></i>
              <span>Create Content</span>
            </div>
            <div class="nav-item" data-section="manage">
              <i class="fas fa-edit"></i>
              <span>Manage Content</span>
            </div>
            <div class="nav-item" data-section="contact">
              <i class="fas fa-envelope"></i>
              <span>Contact Management</span>
            </div>
            <div class="nav-item" data-section="getinvolved">
              <i class="fas fa-handshake"></i>
              <span>Get Involved</span>
            </div>
            <div class="nav-item" data-section="media">
              <i class="fas fa-images"></i>
              <span>Media Library</span>
            </div>
            <div class="nav-item" data-section="education">
              <i class="fas fa-graduation-cap"></i>
              <span>Education</span>
            </div>
            <!-- Design Projects Section -->
            <div class="nav-item" data-section="design">
              <i class="fas fa-pencil-ruler"></i>
              <span>Design Projects</span>
            </div>
            <!-- News & Events Section -->
            <div class="nav-item" data-section="newsevents">
              <i class="fas fa-newspaper"></i>
              <span>News & Events</span>
            </div>
            <div class="nav-item" data-section="research">
              <i class="fas fa-lightbulb"></i>
              <span>Research Insights</span>
            </div>
            <div class="nav-item" data-section="colleagues">
              <i class="fas fa-university"></i>
              <span>Architecture Colleagues</span>
            </div>
            <div class="nav-item" data-section="settings">
              <i class="fas fa-cog"></i>
              <span>Settings</span>
            </div>
          </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
          <!-- Header -->
          <div class="header">
            <div class="header-left">
              <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
              </button>
              <h2 id="pageTitle">Dashboard</h2>
            </div>
            <div class="header-right">
              <div class="user-info">
                <div class="user-avatar">
                  <i class="fas fa-user"></i>
                </div>
                <div>
                  <div style="font-weight: 300;">Admin User</div>
                  <div style="font-size: 0.8rem; color: var(--text-muted);">Administrator</div>
                </div>
              </div>
              <button id="logoutBtn" class="btn-secondary">
                <i class="fas fa-sign-out-alt"></i> Logout
              </button>
            </div>
          </div>

          <!-- Content Sections -->
          <div class="content">
            <!-- Dashboard Section -->
            <div id="dashboardSection" class="section">
              <div class="stats-grid">
                <div class="stat-card">
                  <div class="stat-icon">
                    <i class="fas fa-newspaper"></i>
                  </div>
                  <div class="stat-value" id="newsCount">0</div>
                  <div class="stat-label">News Items</div>
                </div>
                <div class="stat-card">
                  <div class="stat-icon">
                    <i class="fas fa-calendar-alt"></i>
                  </div>
                  <div class="stat-value" id="eventsCount">0</div>
                  <div class="stat-label">Events</div>
                </div>
                <div class="stat-card">
                  <div class="stat-icon">
                    <i class="fas fa-project-diagram"></i>
                  </div>
                  <div class="stat-value" id="projectCount">0</div>
                  <div class="stat-label">Projects</div>
                </div>
                <div class="stat-card">
                  <div class="stat-icon">
                    <i class="fas fa-lightbulb"></i>
                  </div>
                  <div class="stat-value" id="insightCount">0</div>
                  <div class="stat-label">Research Insights</div>
                </div>
                <div class="stat-card">
                  <div class="stat-icon">
                    <i class="fas fa-envelope"></i>
                  </div>
                  <div class="stat-value" id="contactCount">0</div>
                  <div class="stat-label">Contact Submissions</div>
                </div>
                <div class="stat-card">
                  <div class="stat-icon">
                    <i class="fas fa-graduation-cap"></i>
                  </div>
                  <div class="stat-value" id="workshopCount">0</div>
                  <div class="stat-label">Workshops</div>
                </div>
                <div class="stat-card">
                  <div class="stat-icon">
                    <i class="fas fa-book"></i>
                  </div>
                  <div class="stat-value" id="tutorialCount">0</div>
                  <div class="stat-label">Tutorials</div>
                </div>
                <div class="stat-card">
                  <div class="stat-icon">
                    <i class="fas fa-university"></i>
                  </div>
                  <div class="stat-value" id="colleaguesContactCount">0</div>
                  <div class="stat-label">Colleagues Contacts</div>
                </div>
                <!-- Design Projects Stats -->
                <div class="stat-card">
                  <div class="stat-icon">
                    <i class="fas fa-pencil-ruler"></i>
                  </div>
                  <div class="stat-value" id="designProjectsCount">0</div>
                  <div class="stat-label">Design Projects</div>
                </div>
                <div class="stat-card">
                  <div class="stat-icon">
                    <i class="fas fa-chart-bar"></i>
                  </div>
                  <div class="stat-value" id="researchArticlesCount">0</div>
                  <div class="stat-label">Research Articles</div>
                </div>
              </div>

              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Recent Activity</h3>
                </div>
                <div id="recentItems" class="items-grid">
                  <!-- Recent items will be loaded here -->
                </div>
              </div>
            </div>

            <!-- Create Content Section -->
            <div id="contentSection" class="section hidden">
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Create New Content</h3>
                </div>
                <form id="contentForm">
                  <div class="form-grid">
                    <div class="input-group">
                      <label for="title">Title *</label>
                      <input id="title" placeholder="Enter item title" required />
                    </div>
                    <div class="input-group">
                      <label for="type">Content Type *</label>
                      <select id="type" required>
                        <option value="news">News</option>
                        <option value="project">Project</option>
                        <option value="insight">Research Insight</option>
                        <option value="event">Event</option>
                        <option value="course">Course</option>
                      </select>
                    </div>
                    <div class="input-group full-width">
                      <label for="content">Content *</label>
                      <textarea id="content" placeholder="Enter detailed content" required></textarea>
                    </div>
                    <div class="input-group">
                      <label for="image">Cover Image</label>
                      <input type="file" id="image" accept="image/*" />
                      <small style="color: var(--text-muted);">Main image for the item (max 5MB)</small>
                    </div>
                    <div class="input-group">
                      <label for="files">Additional Files</label>
                      <input type="file" id="files" multiple accept="image/*,application/pdf" />
                      <small style="color: var(--text-muted);">Upload additional images or PDFs (max 5 files, 5MB each)</small>
                    </div>
                  </div>
                  <div id="uploadProgress" class="progress" style="display:none">
                    <div class="progress-bar"></div>
                  </div>
                  <div class="button-group">
                    <button type="submit" id="uploadBtn" class="btn-primary">
                      <i class="fas fa-upload"></i> Publish Content
                    </button>
                    <button type="reset" class="btn-secondary">
                      <i class="fas fa-undo"></i> Reset Form
                    </button>
                  </div>
                </form>
              </div>
            </div>

            <!-- Manage Content Section -->
            <div id="manageSection" class="section hidden">
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Manage Content</h3>
                  <div class="button-group" style="margin: 0;">
                    <button id="refreshBtn" class="btn-secondary">
                      <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                  </div>
                </div>
                <div id="items" class="items-grid">
                  <!-- Items will be loaded here -->
                </div>
              </div>
            </div>

            <!-- Contact Management Section -->
            <div id="contactSection" class="section hidden">
              <!-- ... existing contact management code ... -->
            </div>

            <!-- Get Involved Management Section -->
            <div id="getinvolvedSection" class="section hidden">
              <!-- ... existing get involved code ... -->
            </div>

            <!-- Media Library Section -->
            <div id="mediaSection" class="section hidden">
              <!-- ... existing media library code ... -->
            </div>

            <!-- Education Management Section -->
            <div id="educationSection" class="section hidden">
              <!-- ... existing education code ... -->
            </div>

            <!-- Design Projects Management Section -->
            <div id="designSection" class="section hidden">
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Design Projects Management</h3>
                  <div class="button-group" style="margin: 0;">
                    <button id="refreshDesign" class="btn-secondary">
                      <i class="fas fa-sync-alt"></i> Refresh All
                    </button>
                  </div>
                </div>

                <!-- Design Projects Stats -->
                <div class="stats-row">
                  <div class="stat-mini-card">
                    <div class="stat-mini-value" id="designTotalProjects">0</div>
                    <div class="stat-mini-label">Total Projects</div>
                  </div>
                  <div class="stat-mini-card">
                    <div class="stat-mini-value" id="designAcademicProjects">0</div>
                    <div class="stat-mini-label">Academic Projects</div>
                  </div>
                  <div class="stat-mini-card">
                    <div class="stat-mini-value" id="designProfessionalProjects">0</div>
                    <div class="stat-mini-label">Professional Projects</div>
                  </div>
                  <div class="stat-mini-card">
                    <div class="stat-mini-value" id="designCompetitionProjects">0</div>
                    <div class="stat-mini-label">Competition Projects</div>
                  </div>
                </div>

                <!-- Design Projects Tabs -->
                <div class="get-involved-tabs">
                  <button class="get-involved-tab active" data-tab="design-all">
                    <i class="fas fa-th"></i> All Projects
                  </button>
                  <button class="get-involved-tab" data-tab="design-academic">
                    <i class="fas fa-graduation-cap"></i> Academic
                  </button>
                  <button class="get-involved-tab" data-tab="design-professional">
                    <i class="fas fa-briefcase"></i> Professional
                  </button>
                  <button class="get-involved-tab" data-tab="design-competition">
                    <i class="fas fa-trophy"></i> Competition
                  </button>
                </div>

                <!-- All Projects Tab -->
                <div id="design-allTab" class="get-involved-content active">
                  <div class="card-header">
                    <h4 class="card-title">All Design Projects</h4>
                    <div class="button-group" style="margin: 0;">
                      <button onclick="loadDesignProjects()" class="btn-secondary">
                        <i class="fas fa-sync-alt"></i> Refresh
                      </button>
                      <button onclick="showAddDesignProjectModal()" class="btn-primary">
                        <i class="fas fa-plus"></i> Add Project
                      </button>
                    </div>
                  </div>
                  <div class="filter-section">
                    <div class="input-group">
                      <label for="sectorFilter">Filter by Sector:</label>
                      <select id="sectorFilter" onchange="filterDesignProjectsBySector()">
                        <option value="">All Sectors</option>
                        <option value="residential">Residential Architecture</option>
                        <option value="interior">Interior Design</option>
                        <option value="refurbishment">Refurbishment</option>
                        <option value="cultural">Cultural Architecture</option>
                        <option value="commercial">Commercial & Offices</option>
                        <option value="hospitality">Hospitality Architecture</option>
                        <option value="public">Public Architecture</option>
                        <option value="healthcare">Healthcare Architecture</option>
                        <option value="educational">Educational Architecture</option>
                        <option value="sports">Sports Architecture</option>
                        <option value="religious">Religious Architecture</option>
                        <option value="industrial">Industrial & Infrastructure</option>
                        <option value="landscape">Landscape & Urbanism</option>
                      </select>
                    </div>
                  </div>
                  <div id="designProjectsList" class="items-grid">
                    <!-- Design projects will be loaded here -->
                  </div>
                </div>

                <!-- Academic Projects Tab -->
                <div id="design-academicTab" class="get-involved-content">
                  <div class="card-header">
                    <h4 class="card-title">Academic Design Projects</h4>
                    <div class="button-group" style="margin: 0;">
                      <button onclick="loadAcademicProjects()" class="btn-secondary">
                        <i class="fas fa-sync-alt"></i> Refresh
                      </button>
                      <button onclick="showAddDesignProjectModal('academic')" class="btn-primary">
                        <i class="fas fa-plus"></i> Add Academic Project
                      </button>
                    </div>
                  </div>
                  <div class="filter-section">
                    <div class="input-group">
                      <label for="academicSectorFilter">Filter by Sector:</label>
                      <select id="academicSectorFilter" onchange="filterAcademicProjectsBySector()">
                        <option value="">All Sectors</option>
                        <option value="residential">Residential Architecture</option>
                        <option value="interior">Interior Design</option>
                        <option value="refurbishment">Refurbishment</option>
                        <option value="cultural">Cultural Architecture</option>
                        <option value="commercial">Commercial & Offices</option>
                        <option value="hospitality">Hospitality Architecture</option>
                        <option value="public">Public Architecture</option>
                        <option value="healthcare">Healthcare Architecture</option>
                        <option value="educational">Educational Architecture</option>
                        <option value="sports">Sports Architecture</option>
                        <option value="religious">Religious Architecture</option>
                        <option value="industrial">Industrial & Infrastructure</option>
                        <option value="landscape">Landscape & Urbanism</option>
                      </select>
                    </div>
                  </div>
                  <div id="academicProjectsList" class="items-grid">
                    <!-- Academic projects will be loaded here -->
                  </div>
                </div>

                <!-- Professional Projects Tab -->
                <div id="design-professionalTab" class="get-involved-content">
                  <div class="card-header">
                    <h4 class="card-title">Professional Design Projects</h4>
                    <div class="button-group" style="margin: 0;">
                      <button onclick="loadProfessionalProjects()" class="btn-secondary">
                        <i class="fas fa-sync-alt"></i> Refresh
                      </button>
                      <button onclick="showAddDesignProjectModal('professional')" class="btn-primary">
                        <i class="fas fa-plus"></i> Add Professional Project
                      </button>
                    </div>
                  </div>
                  <div class="filter-section">
                    <div class="input-group">
                      <label for="professionalSectorFilter">Filter by Sector:</label>
                      <select id="professionalSectorFilter" onchange="filterProfessionalProjectsBySector()">
                        <option value="">All Sectors</option>
                        <option value="residential">Residential Architecture</option>
                        <option value="interior">Interior Design</option>
                        <option value="refurbishment">Refurbishment</option>
                        <option value="cultural">Cultural Architecture</option>
                        <option value="commercial">Commercial & Offices</option>
                        <option value="hospitality">Hospitality Architecture</option>
                        <option value="public">Public Architecture</option>
                        <option value="healthcare">Healthcare Architecture</option>
                        <option value="educational">Educational Architecture</option>
                        <option value="sports">Sports Architecture</option>
                        <option value="religious">Religious Architecture</option>
                        <option value="industrial">Industrial & Infrastructure</option>
                        <option value="landscape">Landscape & Urbanism</option>
                      </select>
                    </div>
                  </div>
                  <div id="professionalProjectsList" class="items-grid">
                    <!-- Professional projects will be loaded here -->
                  </div>
                </div>

                <!-- Competition Projects Tab -->
                <div id="design-competitionTab" class="get-involved-content">
                  <div class="card-header">
                    <h4 class="card-title">Competition Design Projects</h4>
                    <div class="button-group" style="margin: 0;">
                      <button onclick="loadCompetitionProjects()" class="btn-secondary">
                        <i class="fas fa-sync-alt"></i> Refresh
                      </button>
                      <button onclick="showAddDesignProjectModal('competition')" class="btn-primary">
                        <i class="fas fa-plus"></i> Add Competition Project
                      </button>
                    </div>
                  </div>
                  <div class="filter-section">
                    <div class="input-group">
                      <label for="competitionSectorFilter">Filter by Sector:</label>
                      <select id="competitionSectorFilter" onchange="filterCompetitionProjectsBySector()">
                        <option value="">All Sectors</option>
                        <option value="residential">Residential Architecture</option>
                        <option value="interior">Interior Design</option>
                        <option value="refurbishment">Refurbishment</option>
                        <option value="cultural">Cultural Architecture</option>
                        <option value="commercial">Commercial & Offices</option>
                        <option value="hospitality">Hospitality Architecture</option>
                        <option value="public">Public Architecture</option>
                        <option value="healthcare">Healthcare Architecture</option>
                        <option value="educational">Educational Architecture</option>
                        <option value="sports">Sports Architecture</option>
                        <option value="religious">Religious Architecture</option>
                        <option value="industrial">Industrial & Infrastructure</option>
                        <option value="landscape">Landscape & Urbanism</option>
                      </select>
                    </div>
                  </div>
                  <div id="competitionProjectsList" class="items-grid">
                    <!-- Competition projects will be loaded here -->
                  </div>
                </div>
              </div>
            </div>

            <!-- News & Events Management Section -->
            <div id="newseventsSection" class="section hidden">
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">News & Events Management</h3>
                  <div class="button-group" style="margin: 0;">
                    <button id="refreshNewsEvents" class="btn-secondary">
                      <i class="fas fa-sync-alt"></i> Refresh All
                    </button>
                  </div>
                </div>

                <!-- News & Events Stats -->
                <div class="stats-row">
                  <div class="stat-mini-card">
                    <div class="stat-mini-value" id="newsTotal">0</div>
                    <div class="stat-mini-label">Total News</div>
                  </div>
                  <div class="stat-mini-card">
                    <div class="stat-mini-value" id="eventsTotal">0</div>
                    <div class="stat-mini-label">Total Events</div>
                  </div>
                  <div class="stat-mini-card">
                    <div class="stat-mini-value" id="newsFeatured">0</div>
                    <div class="stat-mini-label">Featured News</div>
                  </div>
                  <div class="stat-mini-card">
                    <div class="stat-mini-value" id="eventsFeatured">0</div>
                    <div class="stat-mini-label">Featured Events</div>
                  </div>
                </div>

                <!-- News & Events Tabs -->
                <div class="get-involved-tabs">
                  <button class="get-involved-tab active" data-tab="newsevents-all">
                    <i class="fas fa-th"></i> All
                  </button>
                  <button class="get-involved-tab" data-tab="newsevents-news">
                    <i class="fas fa-newspaper"></i> News
                  </button>
                  <button class="get-involved-tab" data-tab="newsevents-events">
                    <i class="fas fa-calendar-alt"></i> Events
                  </button>
                </div>

                <!-- All News & Events Tab -->
                <div id="newsevents-allTab" class="get-involved-content active">
                  <div class="card-header">
                    <h4 class="card-title">All News & Events</h4>
                    <div class="button-group" style="margin: 0;">
                      <button onclick="loadAllNewsEvents()" class="btn-secondary">
                        <i class="fas fa-sync-alt"></i> Refresh
                      </button>
                      <button onclick="showAddNewsModal()" class="btn-primary">
                        <i class="fas fa-plus"></i> Add News
                      </button>
                      <button onclick="showAddEventModal()" class="btn-primary">
                        <i class="fas fa-plus"></i> Add Event
                      </button>
                    </div>
                  </div>
                  <div id="allNewsEventsList" class="items-grid">
                    <!-- All news and events will be loaded here -->
                  </div>
                </div>

                <!-- News Tab -->
                <div id="newsevents-newsTab" class="get-involved-content">
                  <div class="card-header">
                    <h4 class="card-title">News Articles</h4>
                    <div class="button-group" style="margin: 0;">
                      <button onclick="loadNewsArticles()" class="btn-secondary">
                        <i class="fas fa-sync-alt"></i> Refresh
                      </button>
                      <button onclick="showAddNewsModal()" class="btn-primary">
                        <i class="fas fa-plus"></i> Add News
                      </button>
                    </div>
                  </div>
                  <div id="newsArticlesList" class="items-grid">
                    <!-- News articles will be loaded here -->
                  </div>
                </div>

                <!-- Events Tab -->
                <div id="newsevents-eventsTab" class="get-involved-content">
                  <div class="card-header">
                    <h4 class="card-title">Events</h4>
                    <div class="button-group" style="margin: 0;">
                      <button onclick="loadEvents()" class="btn-secondary">
                        <i class="fas fa-sync-alt"></i> Refresh
                      </button>
                      <button onclick="showAddEventModal()" class="btn-primary">
                        <i class="fas fa-plus"></i> Add Event
                      </button>
                    </div>
                  </div>
                  <div id="eventsList" class="items-grid">
                    <!-- Events will be loaded here -->
                  </div>
                </div>
              </div>
            </div>

            <!-- Research Insights Management Section -->
            <div id="researchSection" class="section hidden">
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Research Insights Management</h3>
                  <div class="button-group" style="margin: 0;">
                    <button id="refreshResearch" class="btn-secondary">
                      <i class="fas fa-sync-alt"></i> Refresh All
                    </button>
                  </div>
                </div>

                <!-- Research Insights Stats -->
                <div class="stats-row">
                  <div class="stat-mini-card">
                    <div class="stat-mini-value" id="researchTotalArticles">0</div>
                    <div class="stat-mini-label">Total Articles</div>
                  </div>
                  <div class="stat-mini-card">
                    <div class="stat-mini-value" id="researchSustainable">0</div>
                    <div class="stat-mini-label">Sustainable Design</div>
                  </div>
                  <div class="stat-mini-card">
                    <div class="stat-mini-value" id="researchClimate">0</div>
                    <div class="stat-mini-label">Climate Resilience</div>
                  </div>
                  <div class="stat-mini-card">
                    <div class="stat-mini-value" id="researchSocial">0</div>
                    <div class="stat-mini-label">Social Impact</div>
                  </div>
                  <div class="stat-mini-card">
                    <div class="stat-mini-value" id="researchFeatured">0</div>
                    <div class="stat-mini-label">Featured</div>
                  </div>
                </div>

                <!-- Research Tabs -->
                <div class="get-involved-tabs">
                  <button class="get-involved-tab active" data-tab="research-all">
                    <i class="fas fa-th"></i> All Articles
                  </button>
                  <button class="get-involved-tab" data-tab="research-sustainable">
                    <i class="fas fa-leaf"></i> Sustainable Design
                  </button>
                  <button class="get-involved-tab" data-tab="research-climate">
                    <i class="fas fa-cloud-sun"></i> Climate Resilience
                  </button>
                  <button class="get-involved-tab" data-tab="research-social">
                    <i class="fas fa-users"></i> Social Impact
                  </button>
                  <button class="get-involved-tab" data-tab="research-technological">
                    <i class="fas fa-microchip"></i> Technological Innovation
                  </button>
                </div>

                <!-- All Articles Tab -->
                <div id="research-allTab" class="get-involved-content active">
                  <div class="card-header">
                    <h4 class="card-title">All Research Articles</h4>
                    <div class="button-group" style="margin: 0;">
                      <button onclick="loadResearchArticles()" class="btn-secondary">
                        <i class="fas fa-sync-alt"></i> Refresh
                      </button>
                      <button onclick="showAddResearchModal()" class="btn-primary">
                        <i class="fas fa-plus"></i> Add Article
                      </button>
                    </div>
                  </div>
                  <div id="researchArticlesList" class="items-grid">
                    <!-- Research articles will be loaded here -->
                  </div>
                </div>

                <!-- Sustainable Design Tab -->
                <div id="research-sustainableTab" class="get-involved-content">
                  <div class="card-header">
                    <h4 class="card-title">Sustainable Design Research</h4>
                    <div class="button-group" style="margin: 0;">
                      <button onclick="loadSustainableResearch()" class="btn-secondary">
                        <i class="fas fa-sync-alt"></i> Refresh
                      </button>
                      <button onclick="showAddResearchModal('sustainable')" class="btn-primary">
                        <i class="fas fa-plus"></i> Add Sustainable Article
                      </button>
                    </div>
                  </div>
                  <div id="sustainableResearchList" class="items-grid">
                    <!-- Sustainable research articles will be loaded here -->
                  </div>
                </div>

                <!-- Climate Resilience Tab -->
                <div id="research-climateTab" class="get-involved-content">
                  <div class="card-header">
                    <h4 class="card-title">Climate Resilience Research</h4>
                    <div class="button-group" style="margin: 0;">
                      <button onclick="loadClimateResearch()" class="btn-secondary">
                        <i class="fas fa-sync-alt"></i> Refresh
                      </button>
                      <button onclick="showAddResearchModal('climate')" class="btn-primary">
                        <i class="fas fa-plus"></i> Add Climate Article
                      </button>
                    </div>
                  </div>
                  <div id="climateResearchList" class="items-grid">
                    <!-- Climate research articles will be loaded here -->
                  </div>
                </div>

                <!-- Social Impact Tab -->
                <div id="research-socialTab" class="get-involved-content">
                  <div class="card-header">
                    <h4 class="card-title">Social Impact Research</h4>
                    <div class="button-group" style="margin: 0;">
                      <button onclick="loadSocialResearch()" class="btn-secondary">
                        <i class="fas fa-sync-alt"></i> Refresh
                      </button>
                      <button onclick="showAddResearchModal('social')" class="btn-primary">
                        <i class="fas fa-plus"></i> Add Social Article
                      </button>
                    </div>
                  </div>
                  <div id="socialResearchList" class="items-grid">
                    <!-- Social research articles will be loaded here -->
                  </div>
                </div>

                <!-- Technological Innovation Tab -->
                <div id="research-technologicalTab" class="get-involved-content">
                  <div class="card-header">
                    <h4 class="card-title">Technological Innovation Research</h4>
                    <div class="button-group" style="margin: 0;">
                      <button onclick="loadTechnologicalResearch()" class="btn-secondary">
                        <i class="fas fa-sync-alt"></i> Refresh
                      </button>
                      <button onclick="showAddResearchModal('technological')" class="btn-primary">
                        <i class="fas fa-plus"></i> Add Tech Article
                      </button>
                    </div>
                  </div>
                  <div id="technologicalResearchList" class="items-grid">
                    <!-- Technological research articles will be loaded here -->
                  </div>
                </div>
              </div>
            </div>

            <!-- Architecture Colleagues Lab Management Section -->
            <div id="colleaguesSection" class="section hidden">
              <!-- ... existing colleagues code ... -->
            </div>

            <div id="settingsSection" class="section hidden">
              <div class="card">
                <h3 class="card-title">Settings</h3>
                <p style="color: var(--text-muted); text-align: center; padding: 2rem;">Settings panel coming soon...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Mobile Overlay -->
    <div class="overlay" id="overlay"></div>

    <!-- News & Events Modals -->
    <!-- Add News Modal -->
    <div id="addNewsModal" class="modal hidden">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Add News Article</h3>
          <button onclick="hideAddNewsModal()" class="btn-secondary">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <form id="addNewsForm">
          <div class="form-grid">
            <div class="input-group full-width">
              <label for="newsTitle">Title *</label>
              <input id="newsTitle" type="text" required />
            </div>
            <div class="input-group full-width">
              <label for="newsExcerpt">Excerpt *</label>
              <textarea id="newsExcerpt" required></textarea>
            </div>
            <div class="input-group full-width">
              <label for="newsContent">Content *</label>
              <textarea id="newsContent" required></textarea>
            </div>
            <div class="input-group">
              <label for="newsCategory">Category</label>
              <input id="newsCategory" type="text" placeholder="e.g., Announcement, Award" />
            </div>
            <div class="input-group">
              <label for="newsAuthor">Author *</label>
              <input id="newsAuthor" type="text" required />
            </div>
            <div class="input-group">
              <label for="newsDate">Date *</label>
              <input id="newsDate" type="date" required />
            </div>
            <div class="input-group">
              <label for="newsReadTime">Read Time</label>
              <input id="newsReadTime" type="text" placeholder="e.g., 3 min read" />
            </div>
            
            <!-- News Image Upload -->
            <div class="input-group full-width">
              <label for="newsImage">News Image</label>
              <div class="file-upload-container" onclick="document.getElementById('newsImageInput').click()">
                <div class="upload-icon">
                  <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <h4>Upload News Image</h4>
                <p>Click to browse or drag and drop</p>
                <p style="font-size: 0.9rem; color: var(--text-muted);">Recommended: 1200x800px, max 5MB</p>
                <input type="file" id="newsImageInput" class="file-input" accept="image/*" onchange="handleNewsImageUpload(event)" />
              </div>
              <div id="newsImagePreview" class="image-preview"></div>
              <input type="hidden" id="newsImage" />
            </div>

            <div class="input-group">
              <label class="toggle-switch" style="display: flex; align-items: center; gap: 1rem;">
                <input type="checkbox" id="newsFeatured" checked>
                <span class="toggle-slider"></span>
                <span>Featured</span>
              </label>
            </div>
            <div class="input-group">
              <label class="toggle-switch" style="display: flex; align-items: center; gap: 1rem;">
                <input type="checkbox" id="newsPublished" checked>
                <span class="toggle-slider"></span>
                <span>Published</span>
              </label>
            </div>
          </div>
          <div class="button-group">
            <button type="submit" class="btn-primary">
              <i class="fas fa-save"></i> Add News
            </button>
            <button type="button" onclick="hideAddNewsModal()" class="btn-secondary">
              <i class="fas fa-times"></i> Cancel
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Add Event Modal -->
    <div id="addEventModal" class="modal hidden">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Add Event</h3>
          <button onclick="hideAddEventModal()" class="btn-secondary">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <form id="addEventForm">
          <div class="form-grid">
            <div class="input-group full-width">
              <label for="eventTitle">Title *</label>
              <input id="eventTitle" type="text" required />
            </div>
            <div class="input-group full-width">
              <label for="eventDescription">Description *</label>
              <textarea id="eventDescription" required></textarea>
            </div>
            <div class="input-group full-width">
              <label for="eventExcerpt">Excerpt *</label>
              <textarea id="eventExcerpt" required></textarea>
            </div>
            <div class="input-group">
              <label for="eventDate">Event Date *</label>
              <input id="eventDate" type="date" required />
            </div>
            <div class="input-group">
              <label for="eventTime">Event Time *</label>
              <input id="eventTime" type="text" placeholder="e.g., 2:00 PM - 5:00 PM" required />
            </div>
            <div class="input-group">
              <label for="eventLocation">Location *</label>
              <input id="eventLocation" type="text" required />
            </div>
            <div class="input-group">
              <label for="eventCategory">Category</label>
              <input id="eventCategory" type="text" placeholder="e.g., Workshop, Conference" />
            </div>
            <div class="input-group">
              <label for="eventAuthor">Author *</label>
              <input id="eventAuthor" type="text" required />
            </div>
            <div class="input-group">
              <label for="eventReadTime">Read Time</label>
              <input id="eventReadTime" type="text" placeholder="e.g., 2 min read" />
            </div>
            
            <!-- Event Image Upload -->
            <div class="input-group full-width">
              <label for="eventImage">Event Image</label>
              <div class="file-upload-container" onclick="document.getElementById('eventImageInput').click()">
                <div class="upload-icon">
                  <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <h4>Upload Event Image</h4>
                <p>Click to browse or drag and drop</p>
                <p style="font-size: 0.9rem; color: var(--text-muted);">Recommended: 1200x800px, max 5MB</p>
                <input type="file" id="eventImageInput" class="file-input" accept="image/*" onchange="handleEventImageUpload(event)" />
              </div>
              <div id="eventImagePreview" class="image-preview"></div>
              <input type="hidden" id="eventImage" />
            </div>

            <div class="input-group">
              <label class="toggle-switch" style="display: flex; align-items: center; gap: 1rem;">
                <input type="checkbox" id="eventFeatured" checked>
                <span class="toggle-slider"></span>
                <span>Featured</span>
              </label>
            </div>
            <div class="input-group">
              <label class="toggle-switch" style="display: flex; align-items: center; gap: 1rem;">
                <input type="checkbox" id="eventPublished" checked>
                <span class="toggle-slider"></span>
                <span>Published</span>
              </label>
            </div>
          </div>
          <div class="button-group">
            <button type="submit" class="btn-primary">
              <i class="fas fa-save"></i> Add Event
            </button>
            <button type="button" onclick="hideAddEventModal()" class="btn-secondary">
              <i class="fas fa-times"></i> Cancel
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Design Project Modals -->
    <!-- Add Design Project Modal -->
    <div id="addDesignProjectModal" class="modal hidden">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Add Design Project</h3>
          <button onclick="hideAddDesignProjectModal()" class="btn-secondary">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <form id="addDesignProjectForm">
          <div class="form-grid">
            <div class="input-group full-width">
              <label for="designProjectTitle">Title *</label>
              <input id="designProjectTitle" type="text" required />
            </div>
            <div class="input-group full-width">
              <label for="designProjectSummary">Summary *</label>
              <textarea id="designProjectSummary" required></textarea>
            </div>
            <div class="input-group full-width">
              <label for="designProjectDescription">Description *</label>
              <textarea id="designProjectDescription" required></textarea>
            </div>
            <div class="input-group">
              <label for="designProjectCategory">Category *</label>
              <select id="designProjectCategory" required>
                <option value="academic">Academic</option>
                <option value="professional">Professional</option>
                <option value="competition">Competition</option>
              </select>
            </div>
            <div class="input-group">
              <label for="designProjectSector">Sector *</label>
              <select id="designProjectSector" required>
                <option value="">Select Sector</option>
                <option value="residential">Residential Architecture</option>
                <option value="interior">Interior Design</option>
                <option value="refurbishment">Refurbishment</option>
                <option value="cultural">Cultural Architecture</option>
                <option value="commercial">Commercial & Offices</option>
                <option value="hospitality">Hospitality Architecture</option>
                <option value="public">Public Architecture</option>
                <option value="healthcare">Healthcare Architecture</option>
                <option value="educational">Educational Architecture</option>
                <option value="sports">Sports Architecture</option>
                <option value="religious">Religious Architecture</option>
                <option value="industrial">Industrial & Infrastructure</option>
                <option value="landscape">Landscape & Urbanism</option>
              </select>
            </div>
            
            <!-- Main Image Upload -->
            <div class="input-group full-width">
              <label for="designProjectMainImage">Main Image *</label>
              <div class="file-upload-container" onclick="document.getElementById('mainImageInput').click()">
                <div class="upload-icon">
                  <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <h4>Upload Main Image</h4>
                <p>Click to browse or drag and drop</p>
                <p style="font-size: 0.9rem; color: var(--text-muted);">Recommended: 1200x800px, max 5MB</p>
                <input type="file" id="mainImageInput" class="file-input" accept="image/*" onchange="handleMainImageUpload(event)" />
              </div>
              <div id="mainImagePreview" class="image-preview"></div>
              <input type="hidden" id="designProjectMainImage" required />
            </div>

            <!-- Gallery Images Upload -->
            <div class="input-group full-width">
              <label for="designProjectGalleryImages">Gallery Images</label>
              <div class="file-upload-container" onclick="document.getElementById('galleryImagesInput').click()">
                <div class="upload-icon">
                  <i class="fas fa-images"></i>
                </div>
                <h4>Upload Gallery Images</h4>
                <p>Click to browse or drag and drop multiple images</p>
                <p style="font-size: 0.9rem; color: var(--text-muted);">Max 10 images, 5MB each</p>
                <input type="file" id="galleryImagesInput" class="file-input" accept="image/*" multiple onchange="handleGalleryImagesUpload(event)" />
              </div>
              <div id="galleryImagesPreview" class="gallery-preview"></div>
              <input type="hidden" id="designProjectGalleryImages" />
            </div>

            <div class="input-group">
              <label for="designProjectDisplayOrder">Display Order</label>
              <input id="designProjectDisplayOrder" type="number" min="0" value="0" />
            </div>
            <div class="input-group">
              <label class="toggle-switch" style="display: flex; align-items: center; gap: 1rem;">
                <input type="checkbox" id="designProjectFeatured" checked>
                <span class="toggle-slider"></span>
                <span>Featured</span>
              </label>
            </div>
            <div class="input-group">
              <label class="toggle-switch" style="display: flex; align-items: center; gap: 1rem;">
                <input type="checkbox" id="designProjectPublished" checked>
                <span class="toggle-slider"></span>
                <span>Published</span>
              </label>
            </div>
          </div>
          <div class="button-group">
            <button type="submit" class="btn-primary">
              <i class="fas fa-save"></i> Add Project
            </button>
            <button type="button" onclick="hideAddDesignProjectModal()" class="btn-secondary">
              <i class="fas fa-times"></i> Cancel
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Add Research Article Modal -->
    <div id="addResearchModal" class="modal hidden">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Add Research Article</h3>
          <button onclick="hideAddResearchModal()" class="btn-secondary">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <form id="addResearchForm">
          <div class="form-grid">
            <div class="input-group full-width">
              <label for="researchTitle">Title *</label>
              <input id="researchTitle" type="text" required />
            </div>
            <div class="input-group full-width">
              <label for="researchAbstract">Abstract *</label>
              <textarea id="researchAbstract" required placeholder="Brief summary of the research"></textarea>
            </div>
            <div class="input-group full-width">
              <label for="researchContent">Full Content *</label>
              <textarea id="researchContent" required placeholder="Detailed research content"></textarea>
            </div>
            <div class="input-group">
              <label for="researchCategory">Category *</label>
              <select id="researchCategory" required>
                <option value="sustainable">Sustainable Design</option>
                <option value="climate">Climate Resilience</option>
                <option value="social">Social Impact</option>
                <option value="technological">Technological Innovation</option>
              </select>
            </div>
            <div class="input-group">
              <label for="researchAuthors">Authors *</label>
              <input id="researchAuthors" type="text" required placeholder="John Doe, Jane Smith" />
            </div>
            <div class="input-group">
              <label for="researchPublicationDate">Publication Date</label>
              <input id="researchPublicationDate" type="date" />
            </div>
            <div class="input-group">
              <label for="researchMainImage">Main Image URL</label>
              <input id="researchMainImage" type="text" placeholder="/images/research/image.jpg" />
            </div>
            <div class="input-group full-width">
              <label for="researchGalleryImages">Gallery Images (JSON array)</label>
              <textarea id="researchGalleryImages" placeholder='["/images/research/image1.jpg", "/images/research/image2.jpg"]'></textarea>
              <small style="color: var(--text-muted);">Enter image URLs as a JSON array</small>
            </div>
            <div class="input-group">
              <label for="researchDisplayOrder">Display Order</label>
              <input id="researchDisplayOrder" type="number" min="0" value="0" />
            </div>
            <div class="input-group">
              <label class="toggle-switch" style="display: flex; align-items: center; gap: 1rem;">
                <input type="checkbox" id="researchFeatured" checked>
                <span class="toggle-slider"></span>
                <span>Featured</span>
              </label>
            </div>
            <div class="input-group">
              <label class="toggle-switch" style="display: flex; align-items: center; gap: 1rem;">
                <input type="checkbox" id="researchPublished" checked>
                <span class="toggle-slider"></span>
                <span>Published</span>
              </label>
            </div>
          </div>
          <div class="button-group">
            <button type="submit" class="btn-primary">
              <i class="fas fa-save"></i> Add Article
            </button>
            <button type="button" onclick="hideAddResearchModal()" class="btn-secondary">
              <i class="fas fa-times"></i> Cancel
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Existing modals for other sections -->
    <!-- ... existing modals ... -->

    <!-- JavaScript Section -->
    <script>
      const API_BASE_URL = 'http://localhost:4000/api';
      let authToken = null;
      let allItems = [];
      let contactSubmissions = [];
      let contactInfo = [];
      let emailSettings = [];
      let currentGetInvolvedTab = 'membership';
      let currentMediaTab = 'photos';
      let currentEducationTab = 'workshops';
      let currentColleaguesTab = 'colleagues-contacts';
      let currentResearchTab = 'research-all';
      let currentDesignTab = 'design-all';
      let currentNewsEventsTab = 'newsevents-all';
      let currentPhotoCategory = 'All';
      
      // File upload state
      let mainImageFile = null;
      let galleryImageFiles = [];
      let uploadedMainImageUrl = '';
      let uploadedGalleryImageUrls = [];
      let newsImageFile = null;
      let uploadedNewsImageUrl = '';
      let eventImageFile = null;
      let uploadedEventImageUrl = '';

      // Stats objects
      let mediaStats = {
        photos: 0,
        videos: 0,
        designs: 0,
        testimonials: 0
      };
      let educationStats = {
        workshops: 0,
        tutorials: 0,
        exhibitions: 0,
        totalEnrolled: 0
      };
      let colleaguesStats = {
        contacts: 0,
        team: 0,
        initiatives: 0,
        newContacts: 0
      };
      let researchStats = {
        articles: 0,
        sustainable: 0,
        climate: 0,
        social: 0,
        technological: 0,
        featured: 0
      };
      let designStats = {
        total: 0,
        academic: 0,
        professional: 0,
        competition: 0,
        featured: 0
      };
      let newsEventsStats = {
        news: 0,
        events: 0,
        featuredNews: 0,
        featuredEvents: 0
      };

      // Sector mapping for display
      const sectorLabels = {
        'residential': 'Residential Architecture',
        'interior': 'Interior Design',
        'refurbishment': 'Refurbishment',
        'cultural': 'Cultural Architecture',
        'commercial': 'Commercial & Offices',
        'hospitality': 'Hospitality Architecture',
        'public': 'Public Architecture',
        'healthcare': 'Healthcare Architecture',
        'educational': 'Educational Architecture',
        'sports': 'Sports Architecture',
        'religious': 'Religious Architecture',
        'industrial': 'Industrial & Infrastructure',
        'landscape': 'Landscape & Urbanism'
      };

      // DOM Elements
      const loginScreen = document.getElementById('loginScreen');
      const dashboard = document.getElementById('dashboard');
      const sidebar = document.getElementById('sidebar');
      const mobileMenuBtn = document.getElementById('mobileMenuBtn');
      const overlay = document.getElementById('overlay');
      const pageTitle = document.getElementById('pageTitle');
      const navItems = document.querySelectorAll('.nav-item');
      const sections = document.querySelectorAll('.section');

      // ===== RESEARCH INSIGHTS FUNCTIONS =====

      // Load Research Stats for Dashboard
      async function loadResearchStats() {
        try {
          const data = await apiRequest('/research/admin/stats');
          researchStats.articles = data.data.total || 0;
          researchStats.sustainable = data.data.sustainable || 0;
          researchStats.climate = data.data.climate || 0;
          researchStats.social = data.data.social || 0;
          researchStats.technological = data.data.technological || 0;
          researchStats.featured = data.data.featured || 0;

          // Update dashboard stats
          document.getElementById('researchArticlesCount').textContent = researchStats.articles;
          document.getElementById('researchTotalArticles').textContent = researchStats.articles;
          document.getElementById('researchSustainable').textContent = researchStats.sustainable;
          document.getElementById('researchClimate').textContent = researchStats.climate;
          document.getElementById('researchSocial').textContent = researchStats.social;
          document.getElementById('researchFeatured').textContent = researchStats.featured;
        } catch (error) {
          console.error('Failed to load research stats:', error);
        }
      }

      // Load All Research Articles
      async function loadResearchArticles() {
        try {
          const data = await apiRequest('/research/admin/articles');
          const container = document.getElementById('researchArticlesList');
          container.innerHTML = '';

          if (!data.data || data.data.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">No research articles found.</p>';
            return;
          }

          data.data.forEach(article => {
            const el = createResearchArticleElement(article);
            container.appendChild(el);
          });
        } catch (error) {
          console.error('Failed to load research articles:', error);
        }
      }

      // Load Sustainable Research
      async function loadSustainableResearch() {
        try {
          const data = await apiRequest('/research/articles/sustainable');
          const container = document.getElementById('sustainableResearchList');
          container.innerHTML = '';

          if (!data.data || data.data.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">No sustainable design research found.</p>';
            return;
          }

          data.data.forEach(article => {
            const el = createResearchArticleElement(article);
            container.appendChild(el);
          });
        } catch (error) {
          console.error('Failed to load sustainable research:', error);
        }
      }

      // Load Climate Research
      async function loadClimateResearch() {
        try {
          const data = await apiRequest('/research/articles/climate');
          const container = document.getElementById('climateResearchList');
          container.innerHTML = '';

          if (!data.data || data.data.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">No climate resilience research found.</p>';
            return;
          }

          data.data.forEach(article => {
            const el = createResearchArticleElement(article);
            container.appendChild(el);
          });
        } catch (error) {
          console.error('Failed to load climate research:', error);
        }
      }

      // Load Social Research
      async function loadSocialResearch() {
        try {
          const data = await apiRequest('/research/articles/social');
          const container = document.getElementById('socialResearchList');
          container.innerHTML = '';

          if (!data.data || data.data.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">No social impact research found.</p>';
            return;
          }

          data.data.forEach(article => {
            const el = createResearchArticleElement(article);
            container.appendChild(el);
          });
        } catch (error) {
          console.error('Failed to load social research:', error);
        }
      }

      // Load Technological Research
      async function loadTechnologicalResearch() {
        try {
          const data = await apiRequest('/research/articles/technological');
          const container = document.getElementById('technologicalResearchList');
          container.innerHTML = '';

          if (!data.data || data.data.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">No technological innovation research found.</p>';
            return;
          }

          data.data.forEach(article => {
            const el = createResearchArticleElement(article);
            container.appendChild(el);
          });
        } catch (error) {
          console.error('Failed to load technological research:', error);
        }
      }

      // Create research article element for display
      function createResearchArticleElement(article) {
        const el = document.createElement('div');
        el.className = 'item';
        
        const content = document.createElement('div');
        content.className = 'item-content';
        
        const title = document.createElement('h4');
        title.className = 'item-title';
        title.textContent = article.title;
        
        const meta = document.createElement('div');
        meta.className = 'item-meta';
        
        const category = document.createElement('span');
        category.className = 'item-type';
        category.textContent = getCategoryDisplayName(article.category);
        
        const authors = document.createElement('span');
        authors.className = 'item-date';
        authors.textContent = article.authors || 'Unknown authors';
        
        meta.appendChild(category);
        meta.appendChild(authors);
        
        const preview = document.createElement('div');
        preview.className = 'item-preview';
        preview.textContent = article.abstract || article.content?.substring(0, 150) + '...' || 'No abstract available';
        
        // Add publication date if available
        if (article.publication_date) {
          const pubDate = document.createElement('div');
          pubDate.className = 'item-date';
          pubDate.textContent = `Published: ${new Date(article.publication_date).toLocaleDateString()}`;
          meta.appendChild(pubDate);
        }
        
        // Add image preview if available
        if (article.main_image) {
          const imgContainer = document.createElement('div');
          imgContainer.style.marginLeft = '1rem';
          imgContainer.style.flexShrink = '0';
          
          const img = document.createElement('img');
          img.src = article.main_image;
          img.alt = article.title;
          img.style.width = '100px';
          img.style.height = '80px';
          img.style.objectFit = 'cover';
          img.style.borderRadius = '6px';
          img.style.border = '1px solid var(--border-light)';
          
          imgContainer.appendChild(img);
          el.appendChild(imgContainer);
        }
        
        content.appendChild(title);
        content.appendChild(meta);
        content.appendChild(preview);

        const actions = document.createElement('div');
        actions.className = 'item-actions';
        
        const editBtn = document.createElement('button');
        editBtn.className = 'btn-secondary';
        editBtn.innerHTML = '<i class="fas fa-edit"></i> Edit';
        editBtn.onclick = () => editResearchArticle(article);
        
        const toggleBtn = document.createElement('button');
        toggleBtn.className = article.is_published ? 'btn-warning' : 'btn-primary';
        toggleBtn.innerHTML = `<i class="fas ${article.is_published ? 'fa-eye-slash' : 'fa-eye'}"></i> ${article.is_published ? 'Unpublish' : 'Publish'}`;
        toggleBtn.onclick = async () => {
          await toggleResearchArticle(article.id, !article.is_published);
        };
        
        const featuredBtn = document.createElement('button');
        featuredBtn.className = article.is_featured ? 'btn-warning' : 'btn-secondary';
        featuredBtn.innerHTML = `<i class="fas ${article.is_featured ? 'fa-star' : 'fa-star'}"></i> ${article.is_featured ? 'Unfeature' : 'Feature'}`;
        featuredBtn.onclick = async () => {
          await toggleFeaturedResearchArticle(article.id, !article.is_featured);
        };
        
        const del = document.createElement('button');
        del.className = 'btn-danger';
        del.innerHTML = '<i class="fas fa-trash"></i> Delete';
        del.onclick = async () => {
          if (confirm('Are you sure you want to delete this research article?')) {
            await deleteResearchArticle(article.id);
          }
        };
        
        actions.appendChild(editBtn);
        actions.appendChild(toggleBtn);
        actions.appendChild(featuredBtn);
        actions.appendChild(del);
        content.appendChild(actions);
        
        el.appendChild(content);
        return el;
      }

      function getCategoryDisplayName(category) {
        const categories = {
          'sustainable': 'Sustainable Design',
          'climate': 'Climate Resilience',
          'social': 'Social Impact',
          'technological': 'Technological Innovation'
        };
        return categories[category] || category;
      }

      // Research Modal Functions
      function showAddResearchModal(category = null) {
        if (category) {
          document.getElementById('researchCategory').value = category;
        }
        document.getElementById('addResearchModal').classList.remove('hidden');
        document.getElementById('researchPublicationDate').valueAsDate = new Date();
      }

      function hideAddResearchModal() {
        document.getElementById('addResearchModal').classList.add('hidden');
        document.getElementById('addResearchForm').reset();
      }

      // Form Submissions for Research Articles
      document.getElementById('addResearchForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const submitBtn = document.getElementById('addResearchForm').querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
        submitBtn.disabled = true;

        try {
          let galleryImages = [];
          const galleryInput = document.getElementById('researchGalleryImages').value;
          if (galleryInput) {
            try {
              galleryImages = JSON.parse(galleryInput);
            } catch (error) {
              throw new Error('Invalid gallery images format. Please use valid JSON array.');
            }
          }

          const articleData = {
            title: document.getElementById('researchTitle').value,
            abstract: document.getElementById('researchAbstract').value,
            content: document.getElementById('researchContent').value,
            category: document.getElementById('researchCategory').value,
            authors: document.getElementById('researchAuthors').value,
            publication_date: document.getElementById('researchPublicationDate').value || null,
            main_image: document.getElementById('researchMainImage').value || null,
            gallery_images: galleryImages,
            display_order: parseInt(document.getElementById('researchDisplayOrder').value) || 0,
            is_featured: document.getElementById('researchFeatured').checked,
            is_published: document.getElementById('researchPublished').checked
          };

          await apiRequest('/research/articles', {
            method: 'POST',
            body: JSON.stringify(articleData)
          });
          
          hideAddResearchModal();
          loadResearchStats();
          showResearchTab(currentResearchTab);
          alert('Research article added successfully!');
        } catch (error) {
          console.error('Failed to add research article:', error);
          alert('Failed to add research article: ' + error.message);
        } finally {
          submitBtn.innerHTML = originalText;
          submitBtn.disabled = false;
        }
      });

      // Research Article CRUD Operations
      async function toggleResearchArticle(id, published) {
        try {
          await apiRequest(`/research/articles/${id}/toggle`, {
            method: 'PATCH'
          });
          loadResearchStats();
          showResearchTab(currentResearchTab);
        } catch (error) {
          console.error('Failed to toggle research article:', error);
          alert('Failed to toggle research article: ' + error.message);
        }
      }

      async function toggleFeaturedResearchArticle(id, featured) {
        try {
          await apiRequest(`/research/articles/${id}/toggle-featured`, {
            method: 'PATCH'
          });
          loadResearchStats();
          showResearchTab(currentResearchTab);
        } catch (error) {
          console.error('Failed to toggle featured research article:', error);
          alert('Failed to toggle featured research article: ' + error.message);
        }
      }

      async function deleteResearchArticle(id) {
        try {
          await apiRequest(`/research/articles/${id}`, {
            method: 'DELETE'
          });
          loadResearchStats();
          showResearchTab(currentResearchTab);
          alert('Research article deleted successfully!');
        } catch (error) {
          console.error('Failed to delete research article:', error);
          alert('Failed to delete research article: ' + error.message);
        }
      }

      function editResearchArticle(article) {
        alert('Edit research article functionality coming soon!');
      }

      // Research Tab Management
      function showResearchTab(tabName) {
        document.querySelectorAll('.get-involved-content').forEach(content => {
          content.classList.remove('active');
        });
        document.querySelectorAll('.get-involved-tab').forEach(tab => {
          tab.classList.remove('active');
        });

        document.getElementById(tabName + 'Tab').classList.add('active');
        document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        currentResearchTab = tabName;

        // Load data for the tab
        switch(tabName) {
          case 'research-all':
            loadResearchArticles();
            break;
          case 'research-sustainable':
            loadSustainableResearch();
            break;
          case 'research-climate':
            loadClimateResearch();
            break;
          case 'research-social':
            loadSocialResearch();
            break;
          case 'research-technological':
            loadTechnologicalResearch();
            break;
        }
      }

      // ===== NEWS & EVENTS FUNCTIONS =====

      // Load News & Events Stats
      async function loadNewsEventsStats() {
        try {
          const data = await apiRequest('/newsevents/health');
          newsEventsStats.news = data.counts?.news || 0;
          newsEventsStats.events = data.counts?.events || 0;
          
          // For featured counts, we'd need to load actual data and filter
          // For now, we'll set placeholder values
          newsEventsStats.featuredNews = 0;
          newsEventsStats.featuredEvents = 0;

          // Update dashboard stats
          document.getElementById('newsCount').textContent = newsEventsStats.news;
          document.getElementById('eventsCount').textContent = newsEventsStats.events;
          
          // Update news & events section stats
          document.getElementById('newsTotal').textContent = newsEventsStats.news;
          document.getElementById('eventsTotal').textContent = newsEventsStats.events;
          document.getElementById('newsFeatured').textContent = newsEventsStats.featuredNews;
          document.getElementById('eventsFeatured').textContent = newsEventsStats.featuredEvents;
        } catch (error) {
          console.error('Failed to load news & events stats:', error);
        }
      }

      // Load All News & Events
      async function loadAllNewsEvents() {
        try {
          const data = await apiRequest('/newsevents/all');
          const container = document.getElementById('allNewsEventsList');
          container.innerHTML = '';

          if (!data || data.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">No news or events found.</p>';
            return;
          }

          data.forEach(item => {
            const el = createNewsEventElement(item);
            container.appendChild(el);
          });
        } catch (error) {
          console.error('Failed to load all news & events:', error);
        }
      }

      // Load News Articles
      async function loadNewsArticles() {
        try {
          const data = await apiRequest('/newsevents/news');
          const container = document.getElementById('newsArticlesList');
          container.innerHTML = '';

          if (!data || data.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">No news articles found.</p>';
            return;
          }

          data.forEach(article => {
            const el = createNewsEventElement(article);
            container.appendChild(el);
          });
        } catch (error) {
          console.error('Failed to load news articles:', error);
        }
      }

      // Load Events
      async function loadEvents() {
        try {
          const data = await apiRequest('/newsevents/events');
          const container = document.getElementById('eventsList');
          container.innerHTML = '';

          if (!data || data.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">No events found.</p>';
            return;
          }

          data.forEach(event => {
            const el = createNewsEventElement(event);
            container.appendChild(el);
          });
        } catch (error) {
          console.error('Failed to load events:', error);
        }
      }

      // Create news/event element for display
      function createNewsEventElement(item) {
        const el = document.createElement('div');
        el.className = 'item';
        
        const content = document.createElement('div');
        content.className = 'item-content';
        
        const title = document.createElement('h4');
        title.className = 'item-title';
        title.textContent = item.title;
        
        const meta = document.createElement('div');
        meta.className = 'item-meta';
        
        const type = document.createElement('span');
        type.className = item.type === 'news' ? 'news-badge' : 'event-badge';
        type.textContent = item.type === 'news' ? 'News' : 'Event';
        
        const author = document.createElement('span');
        author.className = 'item-type';
        author.textContent = `By ${item.author}`;
        
        const date = document.createElement('span');
        date.className = 'item-date';
        date.textContent = new Date(item.date).toLocaleDateString();
        
        const status = document.createElement('span');
        status.className = 'item-date';
        status.textContent = item.is_published ? 'Published' : 'Draft';
        status.style.color = item.is_published ? 'var(--success)' : 'var(--warning)';
        
        meta.appendChild(type);
        meta.appendChild(author);
        meta.appendChild(date);
        meta.appendChild(status);
        
        const preview = document.createElement('div');
        preview.className = 'item-preview';
        preview.textContent = item.excerpt || item.description || 'No excerpt available';
        
        // Add date and location for events
        if (item.type === 'event') {
          const dateDisplay = document.createElement('div');
          dateDisplay.className = 'date-display';
          dateDisplay.innerHTML = `<strong>Date:</strong> ${new Date(item.eventDate).toLocaleDateString()}`;
          
          const timeDisplay = document.createElement('div');
          timeDisplay.className = 'date-display';
          timeDisplay.innerHTML = `<strong>Time:</strong> ${item.eventTime}`;
          
          const locationDisplay = document.createElement('div');
          locationDisplay.className = 'location-display';
          locationDisplay.innerHTML = `<strong>Location:</strong> ${item.location}`;
          
          content.appendChild(dateDisplay);
          content.appendChild(timeDisplay);
          content.appendChild(locationDisplay);
        }
        
        // Add image preview if available
        if (item.image) {
          const imgContainer = document.createElement('div');
          imgContainer.style.marginLeft = '1rem';
          imgContainer.style.flexShrink = '0';
          
          const img = document.createElement('img');
          img.src = item.image;
          img.alt = item.title;
          img.style.width = '100px';
          img.style.height = '80px';
          img.style.objectFit = 'cover';
          img.style.borderRadius = '6px';
          img.style.border = '1px solid var(--border-light)';
          
          imgContainer.appendChild(img);
          el.appendChild(imgContainer);
        }
        
        content.appendChild(title);
        content.appendChild(meta);
        content.appendChild(preview);

        const actions = document.createElement('div');
        actions.className = 'item-actions';
        
        const editBtn = document.createElement('button');
        editBtn.className = 'btn-secondary';
        editBtn.innerHTML = '<i class="fas fa-edit"></i> Edit';
        editBtn.onclick = () => editNewsEvent(item);
        
        const toggleBtn = document.createElement('button');
        toggleBtn.className = item.is_published ? 'btn-warning' : 'btn-primary';
        toggleBtn.innerHTML = `<i class="fas ${item.is_published ? 'fa-eye-slash' : 'fa-eye'}"></i> ${item.is_published ? 'Unpublish' : 'Publish'}`;
        toggleBtn.onclick = async () => {
          await toggleNewsEvent(item.id, !item.is_published, item.type);
        };
        
        const featuredBtn = document.createElement('button');
        featuredBtn.className = item.is_featured ? 'btn-warning' : 'btn-secondary';
        featuredBtn.innerHTML = `<i class="fas ${item.is_featured ? 'fa-star' : 'fa-star'}"></i> ${item.is_featured ? 'Unfeature' : 'Feature'}`;
        featuredBtn.onclick = async () => {
          await toggleFeaturedNewsEvent(item.id, !item.is_featured, item.type);
        };
        
        const del = document.createElement('button');
        del.className = 'btn-danger';
        del.innerHTML = '<i class="fas fa-trash"></i> Delete';
        del.onclick = async () => {
          if (confirm(`Are you sure you want to delete this ${item.type}?`)) {
            await deleteNewsEvent(item.id, item.type);
          }
        };
        
        actions.appendChild(editBtn);
        actions.appendChild(toggleBtn);
        actions.appendChild(featuredBtn);
        actions.appendChild(del);
        content.appendChild(actions);
        
        el.appendChild(content);
        return el;
      }

      // News & Events Modal Functions
      function showAddNewsModal() {
        document.getElementById('addNewsModal').classList.remove('hidden');
        document.getElementById('newsDate').valueAsDate = new Date();
        initializeDragAndDrop();
      }

      function hideAddNewsModal() {
        document.getElementById('addNewsModal').classList.add('hidden');
        document.getElementById('addNewsForm').reset();
        clearNewsUploads();
      }

      function showAddEventModal() {
        document.getElementById('addEventModal').classList.remove('hidden');
        document.getElementById('eventDate').valueAsDate = new Date();
        initializeDragAndDrop();
      }

      function hideAddEventModal() {
        document.getElementById('addEventModal').classList.add('hidden');
        document.getElementById('addEventForm').reset();
        clearEventUploads();
      }

      // News Image Upload
      function handleNewsImageUpload(event) {
        const file = event.target.files[0];
        if (!file) return;

        if (!file.type.startsWith('image/')) {
          alert('Please select an image file');
          return;
        }

        if (file.size > 5 * 1024 * 1024) {
          alert('Image size must be less than 5MB');
          return;
        }

        newsImageFile = file;
        showImagePreview(file, 'newsImagePreview', true);
        uploadNewsImage(file);
      }

      // Event Image Upload
      function handleEventImageUpload(event) {
        const file = event.target.files[0];
        if (!file) return;

        if (!file.type.startsWith('image/')) {
          alert('Please select an image file');
          return;
        }

        if (file.size > 5 * 1024 * 1024) {
          alert('Image size must be less than 5MB');
          return;
        }

        eventImageFile = file;
        showImagePreview(file, 'eventImagePreview', true);
        uploadEventImage(file);
      }

      // Upload News Image
      async function uploadNewsImage(file) {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('type', 'news');

        try {
          const response = await fetch(`${API_BASE_URL}/upload`, {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${authToken || localStorage.getItem('aspire_token')}`
            },
            body: formData
          });

          if (!response.ok) {
            throw new Error('Upload failed');
          }

          const data = await response.json();
          uploadedNewsImageUrl = data.fileUrl;
          document.getElementById('newsImage').value = uploadedNewsImageUrl;
          
          console.log('✅ News image uploaded:', uploadedNewsImageUrl);
        } catch (error) {
          console.error('❌ News image upload failed:', error);
          alert('Failed to upload news image: ' + error.message);
        }
      }

      // Upload Event Image
      async function uploadEventImage(file) {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('type', 'event');

        try {
          const response = await fetch(`${API_BASE_URL}/upload`, {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${authToken || localStorage.getItem('aspire_token')}`
            },
            body: formData
          });

          if (!response.ok) {
            throw new Error('Upload failed');
          }

          const data = await response.json();
          uploadedEventImageUrl = data.fileUrl;
          document.getElementById('eventImage').value = uploadedEventImageUrl;
          
          console.log('✅ Event image uploaded:', uploadedEventImageUrl);
        } catch (error) {
          console.error('❌ Event image upload failed:', error);
          alert('Failed to upload event image: ' + error.message);
        }
      }

      // Clear uploads
      function clearNewsUploads() {
        newsImageFile = null;
        uploadedNewsImageUrl = '';
        document.getElementById('newsImagePreview').innerHTML = '';
        document.getElementById('newsImage').value = '';
        document.getElementById('newsImageInput').value = '';
      }

      function clearEventUploads() {
        eventImageFile = null;
        uploadedEventImageUrl = '';
        document.getElementById('eventImagePreview').innerHTML = '';
        document.getElementById('eventImage').value = '';
        document.getElementById('eventImageInput').value = '';
      }

      // Form Submissions
      document.getElementById('addNewsForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const submitBtn = document.getElementById('addNewsForm').querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
        submitBtn.disabled = true;

        try {
          const newsData = {
            title: document.getElementById('newsTitle').value,
            excerpt: document.getElementById('newsExcerpt').value,
            content: document.getElementById('newsContent').value,
            category: document.getElementById('newsCategory').value,
            author: document.getElementById('newsAuthor').value,
            date: document.getElementById('newsDate').value,
            read_time: document.getElementById('newsReadTime').value,
            image_url: uploadedNewsImageUrl,
            is_featured: document.getElementById('newsFeatured').checked,
            is_published: document.getElementById('newsPublished').checked
          };

          await apiRequest('/newsevents/news', {
            method: 'POST',
            body: JSON.stringify(newsData)
          });
          
          hideAddNewsModal();
          loadNewsEventsStats();
          showNewsEventsTab(currentNewsEventsTab);
          alert('News article added successfully!');
        } catch (error) {
          console.error('Failed to add news article:', error);
          alert('Failed to add news article: ' + error.message);
        } finally {
          submitBtn.innerHTML = originalText;
          submitBtn.disabled = false;
        }
      });

      document.getElementById('addEventForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const submitBtn = document.getElementById('addEventForm').querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
        submitBtn.disabled = true;

        try {
          const eventData = {
            title: document.getElementById('eventTitle').value,
            description: document.getElementById('eventDescription').value,
            excerpt: document.getElementById('eventExcerpt').value,
            event_date: document.getElementById('eventDate').value,
            event_time: document.getElementById('eventTime').value,
            location: document.getElementById('eventLocation').value,
            category: document.getElementById('eventCategory').value,
            author: document.getElementById('eventAuthor').value,
            read_time: document.getElementById('eventReadTime').value,
            image_url: uploadedEventImageUrl,
            is_featured: document.getElementById('eventFeatured').checked,
            is_published: document.getElementById('eventPublished').checked
          };

          await apiRequest('/newsevents/events', {
            method: 'POST',
            body: JSON.stringify(eventData)
          });
          
          hideAddEventModal();
          loadNewsEventsStats();
          showNewsEventsTab(currentNewsEventsTab);
          alert('Event added successfully!');
        } catch (error) {
          console.error('Failed to add event:', error);
          alert('Failed to add event: ' + error.message);
        } finally {
          submitBtn.innerHTML = originalText;
          submitBtn.disabled = false;
        }
      });

      // News & Events CRUD Operations
      async function toggleNewsEvent(id, published, type) {
        try {
          // This would require additional backend endpoints for toggling status
          // For now, we'll reload the data
          loadNewsEventsStats();
          showNewsEventsTab(currentNewsEventsTab);
        } catch (error) {
          console.error('Failed to toggle news/event:', error);
          alert('Failed to toggle news/event: ' + error.message);
        }
      }

      async function toggleFeaturedNewsEvent(id, featured, type) {
        try {
          // This would require additional backend endpoints for toggling featured status
          // For now, we'll reload the data
          loadNewsEventsStats();
          showNewsEventsTab(currentNewsEventsTab);
        } catch (error) {
          console.error('Failed to toggle featured news/event:', error);
          alert('Failed to toggle featured news/event: ' + error.message);
        }
      }

      async function deleteNewsEvent(id, type) {
        try {
          await apiRequest(`/newsevents/${type === 'news' ? 'news' : 'events'}/${id}`, {
            method: 'DELETE'
          });
          loadNewsEventsStats();
          showNewsEventsTab(currentNewsEventsTab);
          alert(`${type === 'news' ? 'News article' : 'Event'} deleted successfully!`);
        } catch (error) {
          console.error('Failed to delete news/event:', error);
          alert('Failed to delete news/event: ' + error.message);
        }
      }

      function editNewsEvent(item) {
        alert(`Edit ${item.type} functionality coming soon!`);
        // TODO: Implement edit functionality
      }

      // News & Events Tab Management
      function showNewsEventsTab(tabName) {
        document.querySelectorAll('.get-involved-content').forEach(content => {
          content.classList.remove('active');
        });
        document.querySelectorAll('.get-involved-tab').forEach(tab => {
          tab.classList.remove('active');
        });

        document.getElementById(tabName + 'Tab').classList.add('active');
        document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        currentNewsEventsTab = tabName;

        // Load data for the tab
        switch(tabName) {
          case 'newsevents-all':
            loadAllNewsEvents();
            break;
          case 'newsevents-news':
            loadNewsArticles();
            break;
          case 'newsevents-events':
            loadEvents();
            break;
        }
      }

      // ===== FILE UPLOAD FUNCTIONS =====

      // Handle main image upload
      function handleMainImageUpload(event) {
        const file = event.target.files[0];
        if (!file) return;

        // Validate file type
        if (!file.type.startsWith('image/')) {
          alert('Please select an image file');
          return;
        }

        // Validate file size (5MB)
        if (file.size > 5 * 1024 * 1024) {
          alert('Image size must be less than 5MB');
          return;
        }

        mainImageFile = file;
        showImagePreview(file, 'mainImagePreview', true);
        
        // Upload the file immediately
        uploadMainImage(file);
      }

      // Handle gallery images upload
      function handleGalleryImagesUpload(event) {
        const files = Array.from(event.target.files);
        if (files.length === 0) return;

        // Validate files
        const validFiles = files.filter(file => {
          if (!file.type.startsWith('image/')) {
            alert(`Skipping ${file.name}: Not an image file`);
            return false;
          }
          if (file.size > 5 * 1024 * 1024) {
            alert(`Skipping ${file.name}: File size must be less than 5MB`);
            return false;
          }
          return true;
        });

        // Add to gallery files array
        galleryImageFiles = [...galleryImageFiles, ...validFiles];
        
        // Show previews
        validFiles.forEach(file => {
          showImagePreview(file, 'galleryImagesPreview', false);
        });

        // Upload gallery images
        uploadGalleryImages(validFiles);
      }

      // Show image preview
      function showImagePreview(file, containerId, isMain) {
        const container = document.getElementById(containerId);
        const reader = new FileReader();

        reader.onload = function(e) {
          const previewItem = document.createElement('div');
          previewItem.className = 'preview-item';
          
          const img = document.createElement('img');
          img.src = e.target.result;
          img.alt = file.name;
          
          const removeBtn = document.createElement('button');
          removeBtn.className = 'remove-btn';
          removeBtn.innerHTML = '<i class="fas fa-times"></i>';
          removeBtn.onclick = function() {
            if (isMain) {
              mainImageFile = null;
              uploadedMainImageUrl = '';
              document.getElementById('designProjectMainImage').value = '';
            } else {
              galleryImageFiles = galleryImageFiles.filter(f => f !== file);
              // Remove from uploaded URLs if already uploaded
              const fileName = file.name;
              uploadedGalleryImageUrls = uploadedGalleryImageUrls.filter(url => !url.includes(fileName));
            }
            previewItem.remove();
          };

          previewItem.appendChild(img);
          previewItem.appendChild(removeBtn);
          container.appendChild(previewItem);
        };

        reader.readAsDataURL(file);
      }

      // Upload main image
      async function uploadMainImage(file) {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('type', 'design-main');

        try {
          const response = await fetch(`${API_BASE_URL}/upload`, {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${authToken || localStorage.getItem('aspire_token')}`
            },
            body: formData
          });

          if (!response.ok) {
            throw new Error('Upload failed');
          }

          const data = await response.json();
          uploadedMainImageUrl = data.fileUrl;
          document.getElementById('designProjectMainImage').value = uploadedMainImageUrl;
          
          console.log('✅ Main image uploaded:', uploadedMainImageUrl);
        } catch (error) {
          console.error('❌ Main image upload failed:', error);
          alert('Failed to upload main image: ' + error.message);
        }
      }

      // Upload gallery images
      async function uploadGalleryImages(files) {
        for (const file of files) {
          const formData = new FormData();
          formData.append('file', file);
          formData.append('type', 'design-gallery');

          try {
            const response = await fetch(`${API_BASE_URL}/upload`, {
              method: 'POST',
              headers: {
                'Authorization': `Bearer ${authToken || localStorage.getItem('aspire_token')}`
              },
              body: formData
            });

            if (!response.ok) {
              throw new Error(`Upload failed for ${file.name}`);
            }

            const data = await response.json();
            uploadedGalleryImageUrls.push(data.fileUrl);
            
            console.log('✅ Gallery image uploaded:', data.fileUrl);
          } catch (error) {
            console.error(`❌ Gallery image upload failed for ${file.name}:`, error);
            alert(`Failed to upload ${file.name}: ${error.message}`);
          }
        }

        // Update the hidden input with JSON array of URLs
        document.getElementById('designProjectGalleryImages').value = JSON.stringify(uploadedGalleryImageUrls);
      }

      // Clear all uploads when modal is closed
      function clearUploads() {
        mainImageFile = null;
        galleryImageFiles = [];
        uploadedMainImageUrl = '';
        uploadedGalleryImageUrls = [];
        
        document.getElementById('mainImagePreview').innerHTML = '';
        document.getElementById('galleryImagesPreview').innerHTML = '';
        document.getElementById('designProjectMainImage').value = '';
        document.getElementById('designProjectGalleryImages').value = '';
        document.getElementById('mainImageInput').value = '';
        document.getElementById('galleryImagesInput').value = '';
      }

      // ===== DESIGN PROJECTS FUNCTIONS =====

      // Load Design Stats for Dashboard
      async function loadDesignStats() {
        try {
          const data = await apiRequest('/design/admin/stats');
          designStats.total = data.data.total || 0;
          designStats.academic = data.data.academic || 0;
          designStats.professional = data.data.professional || 0;
          designStats.competition = data.data.competition || 0;
          designStats.featured = data.data.featured || 0;

          // Update dashboard stats
          document.getElementById('designProjectsCount').textContent = designStats.total;
          document.getElementById('designTotalProjects').textContent = designStats.total;
          document.getElementById('designAcademicProjects').textContent = designStats.academic;
          document.getElementById('designProfessionalProjects').textContent = designStats.professional;
          document.getElementById('designCompetitionProjects').textContent = designStats.competition;
        } catch (error) {
          console.error('Failed to load design stats:', error);
        }
      }

      // Load All Design Projects
      async function loadDesignProjects() {
        try {
          const data = await apiRequest('/design/admin/projects');
          const container = document.getElementById('designProjectsList');
          container.innerHTML = '';

          if (!data.data || data.data.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">No design projects found.</p>';
            return;
          }

          data.data.forEach(project => {
            const el = createDesignProjectElement(project);
            container.appendChild(el);
          });
        } catch (error) {
          console.error('Failed to load design projects:', error);
        }
      }

      // Load Academic Projects
      async function loadAcademicProjects() {
        try {
          const data = await apiRequest('/design/admin/projects/academic');
          const container = document.getElementById('academicProjectsList');
          container.innerHTML = '';

          if (!data.data || data.data.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">No academic projects found.</p>';
            return;
          }

          data.data.forEach(project => {
            const el = createDesignProjectElement(project);
            container.appendChild(el);
          });
        } catch (error) {
          console.error('Failed to load academic projects:', error);
        }
      }

      // Load Professional Projects
      async function loadProfessionalProjects() {
        try {
          const data = await apiRequest('/design/admin/projects/professional');
          const container = document.getElementById('professionalProjectsList');
          container.innerHTML = '';

          if (!data.data || data.data.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">No professional projects found.</p>';
            return;
          }

          data.data.forEach(project => {
            const el = createDesignProjectElement(project);
            container.appendChild(el);
          });
        } catch (error) {
          console.error('Failed to load professional projects:', error);
        }
      }

      // Load Competition Projects
      async function loadCompetitionProjects() {
        try {
          const data = await apiRequest('/design/admin/projects/competition');
          const container = document.getElementById('competitionProjectsList');
          container.innerHTML = '';

          if (!data.data || data.data.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">No competition projects found.</p>';
            return;
          }

          data.data.forEach(project => {
            const el = createDesignProjectElement(project);
            container.appendChild(el);
          });
        } catch (error) {
          console.error('Failed to load competition projects:', error);
        }
      }

      // Create design project element for display
      function createDesignProjectElement(project) {
        const el = document.createElement('div');
        el.className = 'item';
        el.setAttribute('data-sector', project.sector || '');
        
        const content = document.createElement('div');
        content.className = 'item-content';
        
        const title = document.createElement('h4');
        title.className = 'item-title';
        title.textContent = project.title;
        
        const meta = document.createElement('div');
        meta.className = 'item-meta';
        
        const category = document.createElement('span');
        category.className = 'item-type';
        category.textContent = project.category;
        
        const sector = document.createElement('span');
        sector.className = 'sector-badge';
        sector.textContent = sectorLabels[project.sector] || project.sector || 'No Sector';
        
        const status = document.createElement('span');
        status.className = 'item-date';
        status.textContent = project.is_published ? 'Published' : 'Draft';
        status.style.color = project.is_published ? 'var(--success)' : 'var(--warning)';
        
        meta.appendChild(category);
        meta.appendChild(sector);
        meta.appendChild(status);
        
        const preview = document.createElement('div');
        preview.className = 'item-preview';
        preview.textContent = project.summary || 'No summary available';
        
        // Add image preview if available
        if (project.main_image) {
          const imgContainer = document.createElement('div');
          imgContainer.style.marginLeft = '1rem';
          imgContainer.style.flexShrink = '0';
          
          const img = document.createElement('img');
          img.src = project.main_image;
          img.alt = project.title;
          img.style.width = '100px';
          img.style.height = '80px';
          img.style.objectFit = 'cover';
          img.style.borderRadius = '6px';
          img.style.border = '1px solid var(--border-light)';
          
          imgContainer.appendChild(img);
          el.appendChild(imgContainer);
        }
        
        content.appendChild(title);
        content.appendChild(meta);
        content.appendChild(preview);

        const actions = document.createElement('div');
        actions.className = 'item-actions';
        
        const editBtn = document.createElement('button');
        editBtn.className = 'btn-secondary';
        editBtn.innerHTML = '<i class="fas fa-edit"></i> Edit';
        editBtn.onclick = () => editDesignProject(project);
        
        const toggleBtn = document.createElement('button');
        toggleBtn.className = project.is_published ? 'btn-warning' : 'btn-primary';
        toggleBtn.innerHTML = `<i class="fas ${project.is_published ? 'fa-eye-slash' : 'fa-eye'}"></i> ${project.is_published ? 'Unpublish' : 'Publish'}`;
        toggleBtn.onclick = async () => {
          await toggleDesignProject(project.id, !project.is_published);
        };
        
        const featuredBtn = document.createElement('button');
        featuredBtn.className = project.is_featured ? 'btn-warning' : 'btn-secondary';
        featuredBtn.innerHTML = `<i class="fas ${project.is_featured ? 'fa-star' : 'fa-star'}"></i> ${project.is_featured ? 'Unfeature' : 'Feature'}`;
        featuredBtn.onclick = async () => {
          await toggleFeaturedDesignProject(project.id, !project.is_featured);
        };
        
        const del = document.createElement('button');
        del.className = 'btn-danger';
        del.innerHTML = '<i class="fas fa-trash"></i> Delete';
        del.onclick = async () => {
          if (confirm('Are you sure you want to delete this design project?')) {
            await deleteDesignProject(project.id);
          }
        };
        
        actions.appendChild(editBtn);
        actions.appendChild(toggleBtn);
        actions.appendChild(featuredBtn);
        actions.appendChild(del);
        content.appendChild(actions);
        
        el.appendChild(content);
        return el;
      }

      // Filtering functions for sectors
      function filterDesignProjectsBySector() {
        const sector = document.getElementById('sectorFilter').value;
        filterProjectsBySector('designProjectsList', sector);
      }

      function filterAcademicProjectsBySector() {
        const sector = document.getElementById('academicSectorFilter').value;
        filterProjectsBySector('academicProjectsList', sector);
      }

      function filterProfessionalProjectsBySector() {
        const sector = document.getElementById('professionalSectorFilter').value;
        filterProjectsBySector('professionalProjectsList', sector);
      }

      function filterCompetitionProjectsBySector() {
        const sector = document.getElementById('competitionSectorFilter').value;
        filterProjectsBySector('competitionProjectsList', sector);
      }

      function filterProjectsBySector(containerId, sector) {
        const container = document.getElementById(containerId);
        const projects = container.querySelectorAll('.item');
        
        projects.forEach(project => {
          const projectSector = project.getAttribute('data-sector');
          if (!sector || projectSector === sector) {
            project.style.display = 'flex';
          } else {
            project.style.display = 'none';
          }
        });
      }

      // Modal Functions for Design Projects
      function showAddDesignProjectModal(category = null) {
        if (category) {
          document.getElementById('designProjectCategory').value = category;
        }
        document.getElementById('addDesignProjectModal').classList.remove('hidden');
        
        // Initialize drag and drop
        initializeDragAndDrop();
      }

      function hideAddDesignProjectModal() {
        document.getElementById('addDesignProjectModal').classList.add('hidden');
        document.getElementById('addDesignProjectForm').reset();
        clearUploads();
      }

      // Initialize drag and drop functionality
      function initializeDragAndDrop() {
        const uploadContainers = document.querySelectorAll('.file-upload-container');
        
        uploadContainers.forEach(container => {
          container.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('dragover');
          });
          
          container.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
          });
          
          container.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
              if (this.querySelector('#mainImageInput')) {
                // Main image upload
                handleMainImageUpload({ target: { files: [files[0]] } });
              } else {
                // Gallery images upload
                handleGalleryImagesUpload({ target: { files } });
              }
            }
          });
        });
      }

      // Form Submissions for Design Projects
      document.getElementById('addDesignProjectForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const submitBtn = document.getElementById('addDesignProjectForm').querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
        submitBtn.disabled = true;

        try {
          // Validate that main image is uploaded
          if (!uploadedMainImageUrl) {
            throw new Error('Please upload a main image before submitting');
          }

          const projectData = {
            title: document.getElementById('designProjectTitle').value,
            summary: document.getElementById('designProjectSummary').value,
            description: document.getElementById('designProjectDescription').value,
            category: document.getElementById('designProjectCategory').value,
            sector: document.getElementById('designProjectSector').value,
            main_image: uploadedMainImageUrl,
            gallery_images: uploadedGalleryImageUrls,
            display_order: parseInt(document.getElementById('designProjectDisplayOrder').value) || 0,
            is_featured: document.getElementById('designProjectFeatured').checked,
            is_published: document.getElementById('designProjectPublished').checked
          };

          await apiRequest('/design/projects', {
            method: 'POST',
            body: JSON.stringify(projectData)
          });
          
          hideAddDesignProjectModal();
          loadDesignStats();
          showDesignTab(currentDesignTab);
          alert('Design project added successfully!');
        } catch (error) {
          console.error('Failed to add design project:', error);
          alert('Failed to add design project: ' + error.message);
        } finally {
          submitBtn.innerHTML = originalText;
          submitBtn.disabled = false;
        }
      });

      // Design Project CRUD Operations
      async function toggleDesignProject(id, published) {
        try {
          await apiRequest(`/design/projects/${id}/toggle`, {
            method: 'PATCH'
          });
          loadDesignStats();
          showDesignTab(currentDesignTab);
        } catch (error) {
          console.error('Failed to toggle design project:', error);
          alert('Failed to toggle design project: ' + error.message);
        }
      }

      async function toggleFeaturedDesignProject(id, featured) {
        try {
          await apiRequest(`/design/projects/${id}/toggle-featured`, {
            method: 'PATCH'
          });
          loadDesignStats();
          showDesignTab(currentDesignTab);
        } catch (error) {
          console.error('Failed to toggle featured design project:', error);
          alert('Failed to toggle featured design project: ' + error.message);
        }
      }

      async function deleteDesignProject(id) {
        try {
          await apiRequest(`/design/projects/${id}`, {
            method: 'DELETE'
          });
          loadDesignStats();
          showDesignTab(currentDesignTab);
          alert('Design project deleted successfully!');
        } catch (error) {
          console.error('Failed to delete design project:', error);
          alert('Failed to delete design project: ' + error.message);
        }
      }

      function editDesignProject(project) {
        alert('Edit design project functionality coming soon!');
        // TODO: Implement edit functionality
      }

      // ===== EXISTING CODE FROM FILE 1 =====
      // API Helper Functions
      async function apiRequest(endpoint, options = {}) {
        const url = `${API_BASE_URL}${endpoint}`;
        
        // Get current token
        const currentToken = authToken || localStorage.getItem('aspire_token');
        
        const config = {
          headers: {
            'Content-Type': 'application/json',
            ...(currentToken ? { 'Authorization': `Bearer ${currentToken}` } : {}),
            ...options.headers,
          },
          ...options,
        };

        // For FormData requests, remove Content-Type header (browser will set it automatically)
        if (options.body instanceof FormData) {
          delete config.headers['Content-Type'];
        }

        try {
          console.log(`🔄 API Request: ${options.method || 'GET'} ${url}`);
          
          const response = await fetch(url, config);
          
          if (response.status === 401) {
            // Token is invalid/expired
            console.error('❌ Authentication failed (401)');
            localStorage.removeItem('aspire_token');
            authToken = null;
            throw new Error('Authentication failed. Please login again.');
          }
          
          if (!response.ok) {
            const errorText = await response.text();
            console.error('❌ API Error Response:', errorText);
            let errorData;
            try {
              errorData = JSON.parse(errorText);
            } catch {
              errorData = { error: `HTTP ${response.status}: ${response.statusText}` };
            }
            throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
          }
          
          const data = await response.json();
          console.log(`✅ API Success for ${endpoint}`);
          return data;
        } catch (error) {
          console.error('❌ API Request failed:', error);
          
          // If it's an auth error, redirect to login
          if (error.message.includes('Authentication failed') || error.message.includes('Authentication required')) {
            showLogin();
          }
          
          throw error;
        }
      }

      // Enhanced uploadFile function with better error handling
      async function uploadFile(file, type) {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('type', type);

        try {
          console.log(`📤 Uploading ${type} file:`, file.name, file.size, file.type);
          
          const response = await fetch(`${API_BASE_URL}/upload`, {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${authToken || localStorage.getItem('aspire_token')}`
            },
            body: formData
          });

          console.log('📤 Upload response status:', response.status);
          
          if (!response.ok) {
            const errorText = await response.text();
            console.error('❌ Upload failed with response:', errorText);
            throw new Error(`Upload failed: ${response.status} - ${errorText}`);
          }

          const data = await response.json();
          console.log('📤 Upload response data:', data);
          
          // Handle different response formats
          const fileUrl = data.fileUrl || data.url || data.path || data.filePath;
          if (!fileUrl) {
            console.error('❌ No file URL in response:', data);
            throw new Error('Upload response missing file URL');
          }
          
          console.log('✅ Upload successful, file URL:', fileUrl);
          return fileUrl;
        } catch (error) {
          console.error('❌ File upload error:', error);
          throw error;
        }
      }

      // Initialize all event listeners
      function initializeEventListeners() {
        // Refresh buttons initialization with null checks
        const refreshNewsEventsBtn = document.getElementById('refreshNewsEvents');
        if (refreshNewsEventsBtn) {
          refreshNewsEventsBtn.onclick = () => {
            loadNewsEventsStats();
            showNewsEventsTab(currentNewsEventsTab);
          };
        }

        const refreshDesignBtn = document.getElementById('refreshDesign');
        if (refreshDesignBtn) {
          refreshDesignBtn.onclick = () => {
            loadDesignStats();
            showDesignTab(currentDesignTab);
          };
        }

        const refreshResearchBtn = document.getElementById('refreshResearch');
        if (refreshResearchBtn) {
          refreshResearchBtn.onclick = () => {
            loadResearchStats();
            showResearchTab(currentResearchTab);
          };
        }

        // Other existing refresh buttons
        const refreshBtn = document.getElementById('refreshBtn');
        if (refreshBtn) refreshBtn.onclick = loadItems;
        
        const refreshContact = document.getElementById('refreshContact');
        if (refreshContact) refreshContact.onclick = loadContactData;
        
        const refreshGetInvolved = document.getElementById('refreshGetInvolved');
        if (refreshGetInvolved) refreshGetInvolved.onclick = () => showGetInvolvedTab(currentGetInvolvedTab);
        
        const refreshMedia = document.getElementById('refreshMedia');
        if (refreshMedia) refreshMedia.onclick = () => showMediaTab(currentMediaTab);
        
        const refreshEducation = document.getElementById('refreshEducation');
        if (refreshEducation) refreshEducation.onclick = () => showEducationTab(currentEducationTab);
        
        const refreshColleagues = document.getElementById('refreshColleagues');
        if (refreshColleagues) refreshColleagues.onclick = () => showColleaguesTab(currentColleaguesTab);
      }

      // Navigation
      navItems.forEach(item => {
        item.addEventListener('click', () => {
          const section = item.getAttribute('data-section');
          showSection(section);
          
          // Update active nav item
          navItems.forEach(nav => nav.classList.remove('active'));
          item.classList.add('active');
          
          // Update page title
          pageTitle.textContent = item.querySelector('span').textContent;
          
          // Load section-specific data
          if (section === 'contact') {
            loadContactData();
          } else if (section === 'dashboard') {
            loadDashboardData();
          } else if (section === 'manage') {
            loadItems();
          } else if (section === 'getinvolved') {
            showGetInvolvedTab('membership');
          } else if (section === 'media') {
            loadMediaStats();
            showMediaTab('photos');
          } else if (section === 'education') {
            loadEducationStats();
            showEducationTab('workshops');
          } else if (section === 'design') {
            loadDesignStats();
            showDesignTab('design-all');
          } else if (section === 'newsevents') {
            loadNewsEventsStats();
            showNewsEventsTab('newsevents-all');
          } else if (section === 'research') {
            loadResearchStats();
            showResearchTab('research-all');
          } else if (section === 'colleagues') {
            loadColleaguesStats();
            showColleaguesTab('colleagues-contacts');
          }
          
          // Close mobile menu
          if (window.innerWidth <= 1024) {
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
          }
        });
      });

      function showSection(sectionName) {
        sections.forEach(section => {
          section.classList.add('hidden');
        });
        const targetSection = document.getElementById(sectionName + 'Section');
        if (targetSection) {
          targetSection.classList.remove('hidden');
        }
      }

      // Design Projects Management Functions
      document.querySelectorAll('.get-involved-tab[data-tab]').forEach(tab => {
        tab.addEventListener('click', () => {
          const tabName = tab.getAttribute('data-tab');
          if (tabName.startsWith('design-')) {
            showDesignTab(tabName);
          } else if (tabName.startsWith('research-')) {
            showResearchTab(tabName);
          } else if (tabName.startsWith('colleagues-')) {
            showColleaguesTab(tabName);
          } else if (tabName.startsWith('newsevents-')) {
            showNewsEventsTab(tabName);
          } else {
            // Handle other tabs
            showGetInvolvedTab(tabName);
            showMediaTab(tabName);
            showEducationTab(tabName);
          }
        });
      });

      function showDesignTab(tabName) {
        // Hide all design tabs
        document.querySelectorAll('.get-involved-content').forEach(content => {
          content.classList.remove('active');
        });
        document.querySelectorAll('.get-involved-tab').forEach(tab => {
          tab.classList.remove('active');
        });

        // Show selected tab
        document.getElementById(tabName + 'Tab').classList.add('active');
        document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        currentDesignTab = tabName;

        // Load data for the tab
        switch(tabName) {
          case 'design-all':
            loadDesignProjects();
            break;
          case 'design-academic':
            loadAcademicProjects();
            break;
          case 'design-professional':
            loadProfessionalProjects();
            break;
          case 'design-competition':
            loadCompetitionProjects();
            break;
        }
      }

      // Load Dashboard Data
      async function loadDashboardData() {
        try {
          console.log('📊 Loading dashboard data...');
          await loadItems();
          await loadContactStats();
          await loadEducationStats();
          await loadColleaguesStats();
          await loadResearchStats();
          await loadDesignStats();
          await loadNewsEventsStats();
        } catch (error) {
          console.error('Failed to load dashboard data:', error);
          setDefaultStats();
        }
      }

      // Default stats for dashboard
      function setDefaultStats() {
        document.getElementById('newsCount').textContent = '0';
        document.getElementById('eventsCount').textContent = '0';
        document.getElementById('projectCount').textContent = '0';
        document.getElementById('insightCount').textContent = '0';
        document.getElementById('contactCount').textContent = '0';
        document.getElementById('workshopCount').textContent = '0';
        document.getElementById('tutorialCount').textContent = '0';
        document.getElementById('colleaguesContactCount').textContent = '0';
        document.getElementById('designProjectsCount').textContent = '0';
        document.getElementById('researchArticlesCount').textContent = '0';
      }

      // Load items for manage section
      async function loadItems() {
        try {
          const data = await apiRequest('/items');
          allItems = data.data || [];
          updateItemCounts();
          displayItems();
        } catch (error) {
          console.error('Failed to load items:', error);
        }
      }

      function updateItemCounts() {
        const newsCount = allItems.filter(item => item.type === 'news').length;
        const projectCount = allItems.filter(item => item.type === 'project').length;
        const insightCount = allItems.filter(item => item.type === 'insight').length;
        
        document.getElementById('newsCount').textContent = newsCount;
        document.getElementById('projectCount').textContent = projectCount;
        document.getElementById('insightCount').textContent = insightCount;
      }

      function displayItems() {
        const container = document.getElementById('items');
        container.innerHTML = '';

        if (allItems.length === 0) {
          container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">No items found.</p>';
          return;
        }

        allItems.forEach(item => {
          const el = document.createElement('div');
          el.className = 'item';
          el.innerHTML = `
            <div class="item-content">
              <h4 class="item-title">${item.title}</h4>
              <div class="item-meta">
                <span class="item-type">${item.type}</span>
                <span class="item-date">${new Date(item.created_at).toLocaleDateString()}</span>
              </div>
              <div class="item-preview">${item.content.substring(0, 100)}...</div>
              <div class="item-actions">
                <button class="btn-secondary" onclick="editItem('${item.id}')">
                  <i class="fas fa-edit"></i> Edit
                </button>
                <button class="btn-danger" onclick="deleteItem('${item.id}')">
                  <i class="fas fa-trash"></i> Delete
                </button>
              </div>
            </div>
          `;
          container.appendChild(el);
        });
      }

      // Content form submission
      document.getElementById('contentForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const submitBtn = document.getElementById('uploadBtn');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Publishing...';
        submitBtn.disabled = true;

        try {
          const formData = {
            title: document.getElementById('title').value,
            type: document.getElementById('type').value,
            content: document.getElementById('content').value,
          };

          // Handle file uploads
          const imageFile = document.getElementById('image').files[0];
          if (imageFile) {
            const imageUrl = await uploadFile(imageFile, 'image');
            formData.image = imageUrl;
          }

          const additionalFiles = document.getElementById('files').files;
          if (additionalFiles.length > 0) {
            const fileUrls = [];
            for (let file of additionalFiles) {
              const fileUrl = await uploadFile(file, 'file');
              fileUrls.push(fileUrl);
            }
            formData.files = fileUrls;
          }

          await apiRequest('/items', {
            method: 'POST',
            body: JSON.stringify(formData)
          });
          
          document.getElementById('contentForm').reset();
          alert('Content published successfully!');
          loadItems();
        } catch (error) {
          console.error('Failed to publish content:', error);
          alert('Failed to publish content: ' + error.message);
        } finally {
          submitBtn.innerHTML = originalText;
          submitBtn.disabled = false;
        }
      });

      // Contact management functions
      async function loadContactData() {
        try {
          const data = await apiRequest('/contact/submissions');
          contactSubmissions = data.data || [];
          updateContactStats();
          displayContactSubmissions();
        } catch (error) {
          console.error('Failed to load contact data:', error);
        }
      }

      function updateContactStats() {
        const total = contactSubmissions.length;
        const unread = contactSubmissions.filter(sub => !sub.read).length;
        const thisMonth = contactSubmissions.filter(sub => {
          const subDate = new Date(sub.created_at);
          const now = new Date();
          return subDate.getMonth() === now.getMonth() && subDate.getFullYear() === now.getFullYear();
        }).length;

        document.getElementById('contactCount').textContent = total;
        document.getElementById('contactTotal').textContent = total;
        document.getElementById('contactUnread').textContent = unread;
        document.getElementById('contactThisMonth').textContent = thisMonth;
      }

      function displayContactSubmissions() {
        const container = document.getElementById('contactSubmissionsList');
        container.innerHTML = '';

        if (contactSubmissions.length === 0) {
          container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">No contact submissions found.</p>';
          return;
        }

        contactSubmissions.forEach(submission => {
          const el = document.createElement('div');
          el.className = `item ${submission.read ? '' : 'unread'}`;
          el.innerHTML = `
            <div class="item-content">
              <h4 class="item-title">${submission.name} - ${submission.email}</h4>
              <div class="item-meta">
                <span class="item-type">${submission.subject}</span>
                <span class="item-date">${new Date(submission.created_at).toLocaleDateString()}</span>
                ${submission.read ? '' : '<span class="badge">New</span>'}
              </div>
              <div class="item-preview">${submission.message.substring(0, 150)}...</div>
              <div class="item-actions">
                <button class="btn-secondary" onclick="viewContactSubmission('${submission.id}')">
                  <i class="fas fa-eye"></i> View
                </button>
                <button class="btn-primary" onclick="markAsRead('${submission.id}')">
                  <i class="fas fa-check"></i> Mark Read
                </button>
                <button class="btn-danger" onclick="deleteContactSubmission('${submission.id}')">
                  <i class="fas fa-trash"></i> Delete
                </button>
              </div>
            </div>
          `;
          container.appendChild(el);
        });
      }

      // Get Involved tab management
      function showGetInvolvedTab(tabName) {
        document.querySelectorAll('.get-involved-content').forEach(content => {
          content.classList.remove('active');
        });
        document.querySelectorAll('.get-involved-tab').forEach(tab => {
          tab.classList.remove('active');
        });

        document.getElementById(tabName + 'Tab').classList.add('active');
        document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        currentGetInvolvedTab = tabName;

        // Load data for the tab
        switch(tabName) {
          case 'membership':
            loadMembershipApplications();
            break;
          case 'volunteer':
            loadVolunteerApplications();
            break;
          case 'collaboration':
            loadCollaborationRequests();
            break;
        }
      }

      // Media tab management
      function showMediaTab(tabName) {
        document.querySelectorAll('.get-involved-content').forEach(content => {
          content.classList.remove('active');
        });
        document.querySelectorAll('.get-involved-tab').forEach(tab => {
          tab.classList.remove('active');
        });

        document.getElementById(tabName + 'Tab').classList.add('active');
        document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        currentMediaTab = tabName;

        // Load data for the tab
        switch(tabName) {
          case 'photos':
            loadPhotos();
            break;
          case 'videos':
            loadVideos();
            break;
          case 'designs':
            loadDesigns();
            break;
          case 'testimonials':
            loadTestimonials();
            break;
        }
      }

      // Education tab management
      function showEducationTab(tabName) {
        document.querySelectorAll('.get-involved-content').forEach(content => {
          content.classList.remove('active');
        });
        document.querySelectorAll('.get-involved-tab').forEach(tab => {
          tab.classList.remove('active');
        });

        document.getElementById(tabName + 'Tab').classList.add('active');
        document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        currentEducationTab = tabName;

        // Load data for the tab
        switch(tabName) {
          case 'workshops':
            loadWorkshops();
            break;
          case 'tutorials':
            loadTutorials();
            break;
          case 'exhibitions':
            loadExhibitions();
            break;
        }
      }

      // Colleagues tab management
      function showColleaguesTab(tabName) {
        document.querySelectorAll('.get-involved-content').forEach(content => {
          content.classList.remove('active');
        });
        document.querySelectorAll('.get-involved-tab').forEach(tab => {
          tab.classList.remove('active');
        });

        document.getElementById(tabName + 'Tab').classList.add('active');
        document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        currentColleaguesTab = tabName;

        // Load data for the tab
        switch(tabName) {
          case 'colleagues-contacts':
            loadColleaguesContacts();
            break;
          case 'colleagues-team':
            loadTeamMembers();
            break;
          case 'colleagues-initiatives':
            loadInitiatives();
            break;
        }
      }

      // Placeholder functions for other sections
      async function loadMembershipApplications() {
        document.getElementById('membershipList').innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">Loading membership applications...</p>';
      }

      async function loadVolunteerApplications() {
        document.getElementById('volunteerList').innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">Loading volunteer applications...</p>';
      }

      async function loadCollaborationRequests() {
        document.getElementById('collaborationList').innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">Loading collaboration requests...</p>';
      }

      async function loadMediaStats() {
        // Placeholder for media stats
      }

      async function loadPhotos() {
        document.getElementById('photosList').innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">Loading photos...</p>';
      }

      async function loadVideos() {
        document.getElementById('videosList').innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">Loading videos...</p>';
      }

      async function loadDesigns() {
        document.getElementById('designsList').innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">Loading design files...</p>';
      }

      async function loadTestimonials() {
        document.getElementById('testimonialsList').innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">Loading testimonials...</p>';
      }

      async function loadEducationStats() {
        // Placeholder for education stats
      }

      async function loadWorkshops() {
        document.getElementById('workshopsList').innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">Loading workshops...</p>';
      }

      async function loadTutorials() {
        document.getElementById('tutorialsList').innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">Loading tutorials...</p>';
      }

      async function loadExhibitions() {
        document.getElementById('exhibitionsList').innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">Loading exhibitions...</p>';
      }

      async function loadColleaguesStats() {
        // Placeholder for colleagues stats
      }

      async function loadColleaguesContacts() {
        document.getElementById('colleaguesContactsList').innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">Loading colleagues contacts...</p>';
      }

      async function loadTeamMembers() {
        document.getElementById('teamMembersList').innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">Loading team members...</p>';
      }

      async function loadInitiatives() {
        document.getElementById('initiativesList').innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 2rem;">Loading initiatives...</p>';
      }

      // Other placeholder functions
      function showUploadMediaModal() {
        alert('Upload media modal coming soon!');
      }

      function showAddWorkshopModal() {
        alert('Add workshop modal coming soon!');
      }

      function showAddTutorialModal() {
        alert('Add tutorial modal coming soon!');
      }

      function showAddExhibitionModal() {
        alert('Add exhibition modal coming soon!');
      }

      function showAddContactModal() {
        alert('Add contact modal coming soon!');
      }

      function showAddTeamModal() {
        alert('Add team member modal coming soon!');
      }

      function showAddInitiativeModal() {
        alert('Add initiative modal coming soon!');
      }

      function viewContactSubmission(id) {
        alert(`View contact submission ${id}`);
      }

      function markAsRead(id) {
        alert(`Mark as read ${id}`);
      }

      function deleteContactSubmission(id) {
        if (confirm('Are you sure you want to delete this contact submission?')) {
          alert(`Delete contact submission ${id}`);
        }
      }

      function editItem(id) {
        alert(`Edit item ${id}`);
      }

      function deleteItem(id) {
        if (confirm('Are you sure you want to delete this item?')) {
          alert(`Delete item ${id}`);
        }
      }

      // Login functionality
      document.getElementById('loginBtn').addEventListener('click', async () => {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const loginMsg = document.getElementById('loginMsg');
        
        if (!username || !password) {
          loginMsg.innerHTML = '<span style="color: var(--error);">Please enter both username and password</span>';
          return;
        }

        const loginBtn = document.getElementById('loginBtn');
        const originalText = loginBtn.innerHTML;
        loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';
        loginBtn.disabled = true;

        try {
          const response = await fetch(`${API_BASE_URL}/auth/login`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ username, password }),
          });

          if (!response.ok) {
            throw new Error('Login failed');
          }

          const data = await response.json();
          authToken = data.token;
          localStorage.setItem('aspire_token', authToken);
          
          loginMsg.innerHTML = '<span style="color: var(--success);">Login successful! Redirecting...</span>';
          setTimeout(() => {
            showDashboard();
          }, 1000);
        } catch (error) {
          console.error('Login error:', error);
          loginMsg.innerHTML = '<span style="color: var(--error);">Login failed. Please check your credentials.</span>';
        } finally {
          loginBtn.innerHTML = originalText;
          loginBtn.disabled = false;
        }
      });

      // Mobile menu functionality
      mobileMenuBtn.addEventListener('click', () => {
        sidebar.classList.toggle('open');
        overlay.classList.toggle('active');
      });

      overlay.addEventListener('click', () => {
        sidebar.classList.remove('open');
        overlay.classList.remove('active');
      });

      // Logout
      document.getElementById('logoutBtn').onclick = () => { 
        authToken = null; 
        localStorage.removeItem('aspire_token'); 
        dashboard.classList.add('hidden'); 
        loginScreen.classList.remove('hidden'); 
      };

      function showLogin() {
        dashboard.classList.add('hidden');
        loginScreen.classList.remove('hidden');
      }

      async function showDashboard() {
        loginScreen.classList.add('hidden');
        dashboard.classList.remove('hidden');
        authToken = localStorage.getItem('aspire_token');
        
        if (!authToken) {
          showLogin();
          return;
        }
        
        await loadDashboardData();
        initializeEventListeners(); // Initialize event listeners after dashboard loads
      }

      // Auto show if token present
      if (localStorage.getItem('aspire_token')) { 
        showDashboard(); 
      } else {
        // Initialize event listeners for login screen
        initializeEventListeners();
      }
    </script>
  </body>
</html>